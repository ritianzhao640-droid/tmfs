<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è¸é©¬å°ç¥ - ä»£å¸æ“ä½œ</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#0b0f17;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto}
    .container{max-width:420px;margin:0 auto;padding:25px}
    .card{background:#121a29;border-radius:16px;padding:24px;margin-bottom:16px;border:1px solid #1e293b}
    .title{font-size:22px;font-weight:700;color:#ffdf4f;margin-bottom:6px}
    .subtitle{color:#9ca3af;font-size:14px;margin-bottom:20px}
    
    .wallet-box{background:#1e293b;border-radius:12px;padding:12px 16px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}
    .wallet-btn{background:#3b82f6;color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600}
    .wallet-btn:hover{background:#2563eb}
    .wallet-address{font-family:monospace;font-size:13px;color:#9ca3af}
    
    .panel{display:flex;justify-content:space-between;background:#111827;padding:14px 16px;border-radius:12px;margin-bottom:10px;border:1px solid #1f2937}
    .label{color:#9ca3af;font-size:13px}
    .value{color:#fff;font-weight:600;font-size:15px}
    .value.highlight{color:#ffdf4f}
    
    .status-box{background:#1e293b;border:1px solid #374151;border-radius:8px;padding:12px 16px;margin-top:12px;font-size:13px;color:#9ca3af}
    .status-box.error{background:#7f1d1d;border-color:#ef4444;color:#fca5a5}
    .status-box.success{background:#064e3b;border-color:#059669;color:#6ee7b7}
    
    .function-list{margin-top:20px}
    .func-item{background:#1e293b;border-radius:8px;padding:12px;margin-bottom:8px;font-size:13px;color:#9ca3af}
    .func-item.available{color:#4ade80;border-left:3px solid #4ade80}
    .func-item.unavailable{color:#ef4444;border-left:3px solid #ef4444}
  </style>
</head>
<body>
<div class="container">

  <div class="card">
    <div class="wallet-box">
      <div>
        <div style="font-size:12px;color:#9ca3af;margin-bottom:2px">é’±åŒ…çŠ¶æ€</div>
        <div class="wallet-address" id="walletStatus">æœªè¿æ¥</div>
      </div>
      <button class="wallet-btn" id="connectBtn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
    </div>
    
    <div class="title">ğŸ”¥ è¸é©¬å°ç¥</div>
    <div class="subtitle">Four.meme ç¨æ”¶ä»£å¸åˆçº¦</div>

    <div class="panel">
      <div class="label">æˆ‘çš„ä»£å¸ä½™é¢</div>
      <div class="value highlight" id="tokenBalance">--</div>
    </div>
    
    <div class="panel">
      <div class="label">ä»£å¸ç¬¦å·</div>
      <div class="value" id="tokenSymbol">--</div>
    </div>
    
    <div class="panel">
      <div class="label">ç¨æ”¶æ¯”ä¾‹</div>
      <div class="value" id="taxRate">--</div>
    </div>

    <div class="status-box" id="statusBox">
      ç‚¹å‡»"è¿æ¥é’±åŒ…"æŸ¥çœ‹åˆçº¦ä¿¡æ¯
    </div>

    <div class="function-list" id="funcList" style="display:none">
      <div style="font-size:14px;color:#9ca3af;margin-bottom:12px">åˆçº¦åŠŸèƒ½æ£€æµ‹ï¼š</div>
      <div class="func-item available" id="funcBalance">âœ“ æŸ¥è¯¢ä½™é¢ (balanceOf)</div>
      <div class="func-item available" id="funcTransfer">âœ“ è½¬è´¦ (transfer)</div>
      <div class="func-item unavailable" id="funcBurn">âœ— ç‡ƒçƒ§é¢†åˆ†çº¢ (burn) - æœ¬åˆçº¦æ— æ­¤åŠŸèƒ½</div>
      <div class="func-item unavailable" id="funcClaim">âœ— é¢†å–åˆ†çº¢ (claim) - æœ¬åˆçº¦æ— æ­¤åŠŸèƒ½</div>
    </div>
    
    <div style="margin-top:20px;font-size:12px;color:#6b7280;text-align:center">
      åˆçº¦åœ°å€: <span style="font-family:monospace">0x9a88...7777</span>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.3/dist/web3.min.js"></script>
<script>
// é…ç½®
const CONFIG = {
  contractAddress: "0x9a889E525FAEF4851bf5BEbfb5F294AC9D097777",
  chainId: 56,
  chainName: "Binance Smart Chain",
  rpcUrl: "https://bsc-dataseed.binance.org/"
};

// ä¿®æ­£åçš„ABIï¼ˆåªåŒ…å«è¯¥åˆçº¦å®é™…å­˜åœ¨çš„åŠŸèƒ½ï¼‰
const ABI = [
  // æ ‡å‡†ERC20
  {"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"amount","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},
  {"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},
  {"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},
  
  // Four.meme ç¨æ”¶ä»£å¸ç‰¹æœ‰åŠŸèƒ½
  {"constant":true,"inputs":[],"name":"taxRate","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"taxSplitter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"QUOTE_TOKEN","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"}
];

let web3 = null;
let contract = null;
let userAddress = null;

function showStatus(msg, isError) {
  const box = document.getElementById('statusBox');
  box.textContent = msg;
  box.className = 'status-box ' + (isError ? 'error' : 'success');
}

async function connectWallet() {
  const btn = document.getElementById('connectBtn');
  
  try {
    if (!window.ethereum) {
      alert('è¯·å®‰è£…MetaMaské’±åŒ…ï¼');
      return;
    }
    
    btn.textContent = 'è¿æ¥ä¸­...';
    btn.disabled = true;
    
    // è¯·æ±‚è¿æ¥
    await ethereum.request({ method: 'eth_requestAccounts' });
    
    // åˆå§‹åŒ–web3
    web3 = new Web3(ethereum);
    
    // æ£€æŸ¥å¹¶åˆ‡æ¢ç½‘ç»œ
    const chainId = await web3.eth.getChainId();
    if (chainId !== CONFIG.chainId) {
      try {
        await ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x' + CONFIG.chainId.toString(16) }],
        });
      } catch (switchError) {
        if (switchError.code === 4902) {
          await ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0x' + CONFIG.chainId.toString(16),
              chainName: CONFIG.chainName,
              nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
              rpcUrls: [CONFIG.rpcUrl],
              blockExplorerUrls: ['https://bscscan.com/']
            }],
          });
        }
      }
      web3 = new Web3(ethereum);
    }
    
    // è·å–è´¦æˆ·
    const accounts = await web3.eth.getAccounts();
    userAddress = accounts[0];
    
    // åˆå§‹åŒ–åˆçº¦
    contract = new web3.eth.Contract(ABI, CONFIG.contractAddress);
    
    // æ›´æ–°UI
    document.getElementById('walletStatus').textContent = 
      userAddress.slice(0,6) + '...' + userAddress.slice(-4);
    btn.textContent = 'å·²è¿æ¥';
    
    // æ˜¾ç¤ºåŠŸèƒ½åˆ—è¡¨
    document.getElementById('funcList').style.display = 'block';
    
    // åŠ è½½æ•°æ®
    await loadTokenData();
    
    showStatus('è¿æ¥æˆåŠŸï¼è¿™æ˜¯ä¸€ä¸ªFour.memeæ ‡å‡†ç¨æ”¶ä»£å¸åˆçº¦ï¼Œä¸æ”¯æŒç‡ƒçƒ§é¢†åˆ†çº¢åŠŸèƒ½ã€‚', false);
    
    // ç›‘å¬è´¦æˆ·å˜åŒ–
    ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) window.location.reload();
      else {
        userAddress = accounts[0];
        loadTokenData();
      }
    });
    
  } catch (error) {
    console.error(error);
    btn.textContent = 'è¿æ¥å¤±è´¥';
    showStatus('é”™è¯¯: ' + error.message, true);
    setTimeout(() => {
      btn.textContent = 'è¿æ¥é’±åŒ…';
      btn.disabled = false;
    }, 2000);
  }
}

async function loadTokenData() {
  try {
    // æŸ¥è¯¢ä½™é¢
    const balance = await contract.methods.balanceOf(userAddress).call();
    const decimals = await contract.methods.decimals().call();
    const symbol = await contract.methods.symbol().call();
    
    const balanceFormatted = balance / (10 ** decimals);
    document.getElementById('tokenBalance').textContent = 
      balanceFormatted.toFixed(4) + ' ' + symbol;
    document.getElementById('tokenSymbol').textContent = symbol;
    
    // æŸ¥è¯¢ç¨ç‡ï¼ˆå¦‚æœåˆçº¦æ”¯æŒï¼‰
    try {
      const tax = await contract.methods.taxRate().call();
      document.getElementById('taxRate').textContent = (tax / 100) + '%';
    } catch(e) {
      document.getElementById('taxRate').textContent = 'æœªçŸ¥';
    }
    
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
    showStatus('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, true);
  }
}
</script>
</body>
</html>
