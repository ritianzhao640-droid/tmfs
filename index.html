<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d1f15">
    <title>æ–—æ–—åœ°ä¸»å§</title>
    
    <!-- å¼•å…¥ ethers.js ç”¨äºåŒºå—é“¾äº¤äº’ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <style>
        /* ========== åŸºç¡€æ ·å¼ ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif; background: linear-gradient(180deg, #0d1f15 0%, #1a3a2a 50%, #0f2618 100%); min-height: 100vh; color: white; overflow-x: hidden; }
        
        /* ========== é¡µé¢å®¹å™¨ ========== */
        #homePage, #lobbyPage, #rankPage, #profilePage { 
            min-height: 100vh; 
            position: relative; 
            padding-bottom: 80px; 
            display: none;
        }
        
        #homePage { display: block; }
        
        #lobbyPage, #rankPage, #profilePage { 
            background: linear-gradient(180deg, #0d1f15 0%, #1a3a2a 100%); 
        }
        
        /* ========== å…¬å…±ç»„ä»¶ ========== */
        .glass-card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: 20px; margin-bottom: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; margin-bottom: 10px; }
        .logo { font-size: 24px; font-weight: 700; letter-spacing: 1px; background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* ========== é’±åŒ…æ ·å¼ ========== */
        .wallet-icon { width: 48px; height: 48px; background: rgba(255, 255, 255, 0.1); border-radius: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; font-size: 20px; position: relative; }
        .wallet-icon:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.05); }
        .wallet-icon.connected { background: rgba(74, 222, 128, 0.2); border-color: rgba(74, 222, 128, 0.5); }
        .wallet-icon::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            bottom: 2px;
            right: 2px;
            border: 2px solid #0d1f15;
        }
        .wallet-icon.connected::after {
            background: #22c55e;
        }
        
        /* ========== é¦–é¡µæ ·å¼ ========== */
        .container { max-width: 480px; margin: 0 auto; padding: 0 16px; }
        .welcome-text { font-size: 28px; font-weight: 300; margin-bottom: 24px; color: rgba(255, 255, 255, 0.9); }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-label { font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 24px; font-weight: 700; color: #4ade80; }
        
        /* ========== ç¨æ”¶æç¤º ========== */
        .tax-toast { background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 8px; padding: 6px 10px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 11px; backdrop-filter: blur(10px); }
        .tax-dot { width: 5px; height: 5px; border-radius: 50%; display: inline-block; margin-right: 3px; }
        .tax-dot.green { background: #22c55e; }
        .tax-dot.yellow { background: #fbbf24; }
        
        /* ========== é”€æ¯åŒºåŸŸ ========== */
        .burn-section { background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(248, 113, 113, 0.2); border-radius: 20px; padding: 16px; margin-bottom: 16px; }
        .burn-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .burn-icon { width: 40px; height: 40px; background: rgba(220, 38, 38, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .burn-title { font-weight: 600; font-size: 16px; }
        .burn-desc { font-size: 13px; color: rgba(255, 255, 255, 0.5); }
        .burn-input-group { display: flex; gap: 10px; align-items: center; }
        .burn-input { flex: 1; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: white; padding: 12px 16px; border-radius: 12px; font-size: 16px; outline: none; }
        .burn-input:disabled { opacity: 0.5; cursor: not-allowed; }
        .burn-add-btn { background: rgba(255, 255, 255, 0.1); border: none; color: white; padding: 12px 16px; border-radius: 10px; cursor: pointer; font-size: 13px; font-weight: 600; user-select: none; -webkit-user-select: none; touch-action: manipulation; }
        .burn-add-btn:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }
        .burn-add-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* ========== æŒ‰é’®æ ·å¼ ========== */
        .btn { flex: 1; background: rgba(255, 255, 255, 0.1); color: white; border: none; padding: 14px 24px; border-radius: 16px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s; border: 1px solid rgba(255, 255, 255, 0.1); touch-action: manipulation; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3); }
        
        /* ========== åˆ†çº¢åŒºåŸŸ ========== */
        .dividend-section { background: linear-gradient(135deg, rgba(240, 185, 11, 0.1) 0%, rgba(240, 185, 11, 0.03) 100%); border: 1px solid rgba(240, 185, 11, 0.2); border-radius: 20px; padding: 16px; margin-bottom: 20px; }
        .claim-btn { width: 100%; background: linear-gradient(135deg, #F0B90B 0%, #F8D12F 100%); color: #000; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 20px rgba(240, 185, 11, 0.3); touch-action: manipulation; }
        .claim-btn:disabled { opacity: 0.5; cursor: not-allowed; background: rgba(240, 185, 11, 0.3); }
        .claim-btn:active { transform: scale(0.98); }
        
        /* ========== åº•éƒ¨å¯¼èˆª ========== */
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: rgba(13, 31, 21, 0.95); 
            backdrop-filter: blur(20px); 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
            padding: 12px 24px calc(12px + env(safe-area-inset-bottom)); 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            z-index: 1000; 
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: rgba(255, 255, 255, 0.5); text-decoration: none; font-size: 11px; cursor: pointer; transition: all 0.3s; padding: 4px 12px; border-radius: 12px; touch-action: manipulation; }
        .nav-item.active { color: #4ade80; transform: scale(1.05); background: rgba(74, 222, 128, 0.1); }
        .nav-main-btn { width: 56px; height: 56px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-top: -30px; box-shadow: 0 8px 30px rgba(34, 197, 94, 0.4); border: 4px solid #0d1f15; font-size: 24px; cursor: pointer; color: white; transition: all 0.3s; touch-action: manipulation; }
        .nav-main-btn:active { transform: scale(0.95); }
        
        /* ========== å¤§å…é¡µé¢ ========== */
        .lobby-header { padding: 60px 20px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .room-list { padding: 16px; display: flex; flex-direction: column; gap: 12px; padding-bottom: 100px; }
        .room-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 16px; display: flex; align-items: center; gap: 16px; cursor: pointer; transition: all 0.3s; position: relative; touch-action: manipulation; }
        .room-card:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); border-color: rgba(34, 197, 94, 0.3); }
        .room-card.coming-soon { opacity: 0.6; cursor: not-allowed; }
        .room-card.coming-soon:hover { transform: none; border-color: rgba(255,255,255,0.1); }
        .room-icon { width: 56px; height: 56px; background: linear-gradient(135deg, rgba(34,197,94,0.2) 0%, rgba(34,197,94,0.1) 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .room-info { flex: 1; }
        .room-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .room-meta { font-size: 12px; color: rgba(255,255,255,0.5); display: flex; gap: 12px; }
        .room-enter { width: 40px; height: 40px; background: rgba(34, 197, 94, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #4ade80; }
        .room-tag { position: absolute; top: -5px; right: 10px; background: linear-gradient(135deg, #f87171 0%, #dc2626 100%); color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
        
        /* ========== è¿”å›æŒ‰é’® ========== */
        .back-btn { position: absolute; top: 16px; left: 16px; background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; z-index: 10; backdrop-filter: blur(10px); touch-action: manipulation; }
        .back-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }
        
        /* ========== æˆæƒæŒ‰é’® ========== */
        .auth-btn { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; padding: 10px 16px; border-radius: 12px; font-size: 13px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); display: flex; align-items: center; gap: 6px; margin-top: 8px; width: 100%; justify-content: center; transition: all 0.3s; touch-action: manipulation; }
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
        .auth-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .auth-btn.authorized { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .wallet-hint { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 8px; text-align: center; line-height: 1.4; padding: 0 10px; }
        
        /* ========== æç¤ºå¼¹çª— ========== */
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.9); color: white; padding: 12px 24px; border-radius: 24px; font-size: 14px; z-index: 9999; display: none; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); max-width: 80%; text-align: center; }
        .toast.show { display: block; animation: slideDown 0.3s ease; }
        .toast.error { background: rgba(220, 38, 38, 0.9); border-color: rgba(248, 113, 113, 0.3); }
        .toast.success { background: rgba(34, 197, 94, 0.9); border-color: rgba(74, 222, 128, 0.3); }
        @keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        
        /* ========== åŠ è½½åŠ¨ç”» ========== */
        .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ========== æ’è¡Œæ¦œ ========== */
        .rank-header { padding: 60px 20px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .rank-list { padding: 16px; display: flex; flex-direction: column; gap: 10px; padding-bottom: 100px; }
        .rank-item { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 12px; transition: all 0.3s; }
        .rank-item:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .rank-number { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .rank-1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #000; }
        .rank-2 { background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%); color: #000; }
        .rank-3 { background: linear-gradient(135deg, #b45309 0%, #92400e 100%); color: white; }
        .rank-other { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6); }
        .rank-address { flex: 1; font-size: 13px; font-family: monospace; }
        .rank-amount { font-size: 16px; font-weight: 700; color: #f87171; }
        
        /* ========== ä¸ªäººèµ„æ–™ ========== */
        .profile-header { padding: 60px 20px 30px; text-align: center; background: linear-gradient(180deg, rgba(34,197,94,0.1) 0%, transparent 100%); }
        .profile-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; margin: 0 auto 16px; border: 4px solid rgba(34,197,94,0.3); box-shadow: 0 8px 30px rgba(34,197,94,0.3); }
        .profile-address { font-size: 14px; color: rgba(255,255,255,0.6); margin-bottom: 8px; word-break: break-all; padding: 0 20px; }
        .profile-balance { font-size: 32px; font-weight: 700; color: #4ade80; margin-bottom: 4px; text-shadow: 0 2px 10px rgba(74, 222, 128, 0.3); }
        .profile-label { font-size: 12px; color: rgba(255,255,255,0.4); }
        
        /* ========== åŠ¨ç”» ========== */
        @keyframes bounce { 
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 
            40% { transform: translateY(-10px); } 
            60% { transform: translateY(-5px); } 
        }
        
        /* ========== å“åº”å¼ ========== */
        @media (min-width: 768px) { .container { max-width: 480px; margin: 0 auto; } }
    </style>
</head>
<body>
    <!-- æç¤ºæ¡ -->
    <div id="toast" class="toast"></div>

    <!-- é¦–é¡µ -->
    <div id="homePage">
        <div class="header">
            <div class="logo">â™  æ–—æ–—åœ°ä¸»å§</div>
            <div style="display: flex; flex-direction: column; align-items: flex-end;">
                <div class="wallet-icon" id="walletBtn" onclick="connectWallet()">ğŸ’¼</div>
                <div id="authSection" style="display: none; margin-top: 8px;">
                    <button class="auth-btn" id="authBtn" onclick="authorizeToken()" disabled>ğŸ”“ æˆæƒä»£å¸</button>
                </div>
                <div id="walletHint" class="wallet-hint" style="display: none;">
                    æˆæƒä»£å¸ç”¨äºé”€æ¯å’Œæ¸¸æˆåŠŸèƒ½
                </div>
            </div>
        </div>

        <div class="container">
            <div class="welcome-text">
                ä»Šæ—¥å¸ä»· <span id="tokenPrice" style="font-size: 32px; font-weight: 700;">$0.0000</span><br>
                <span id="priceChange" style="font-size: 18px;">+0.00%</span>
            </div>

            <div class="stats-grid">
                <div class="glass-card" style="margin-bottom: 0;">
                    <div class="stat-label">æˆ‘çš„æ–—å¸</div>
                    <div class="stat-value" id="balance">--</div>
                </div>
                <div class="glass-card" style="margin-bottom: 0;">
                    <div class="stat-label" style="color: #fbbf24;">AIå¥–æ± æ–—å¸</div>
                    <div class="stat-value" style="color: #fbbf24;" id="aiPool">--</div>
                </div>
            </div>

            <div class="tax-toast">
                <div style="width: 20px; height: 20px; background: rgba(34,197,94,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px;">â„¹</div>
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600;">
                        <span>äº¤æ˜“ç¨æ”¶</span>
                        <span style="color: #4ade80;">5%</span>
                    </div>
                    <div style="margin-top: 2px;">
                        <span class="tax-dot green"></span>4%é”€æ¯åˆ†WBNB
                        <span style="color: rgba(255,255,255,0.3); margin: 0 4px;">â†’</span>
                        <span class="tax-dot yellow"></span>1%è¥é”€
                    </div>
                </div>
            </div>

            <div class="glass-card" style="text-align: center; padding: 24px;">
                <p style="margin-bottom: 16px; color: rgba(255,255,255,0.6);">ğŸ® æ¸¸æˆå¤§å…æš‚æœªå¼€æ”¾</p>
                <button class="btn btn-primary" onclick="enterLobby()">æŸ¥çœ‹æ¸¸æˆå¤§å…</button>
                <p style="margin-top: 12px; font-size: 12px; color: rgba(255,255,255,0.4);">è¯·å…ˆè¿æ¥é’±åŒ…ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½</p>
            </div>

            <div class="burn-section">
                <div class="burn-header">
                    <div class="burn-icon">ğŸ”¥</div>
                    <div>
                        <div class="burn-title">é”€æ¯æ–—å¸æ¢å–åˆ†çº¢æƒ</div>
                        <div class="burn-desc">å·²é”€æ¯çš„æ–—å¸ä¸å¯èµå›ä½†ä¼šæµè¿›AIæ± </div>
                    </div>
                </div>
                <div class="burn-input-group">
                    <input type="number" class="burn-input" id="burnAmount" value="100" disabled>
                    <button class="burn-add-btn" id="burnAdd100" disabled onmousedown="startLongPress(100)" onmouseup="stopLongPress()" ontouchstart="startLongPress(100)" ontouchend="stopLongPress()" onmouseleave="stopLongPress()">+100</button>
                    <button class="burn-add-btn" id="burnAdd1000" disabled onmousedown="startLongPress(1000)" onmouseup="stopLongPress()" ontouchstart="startLongPress(1000)" ontouchend="stopLongPress()" onmouseleave="stopLongPress()">+1000</button>
                </div>
                <button class="btn" id="burnBtn" style="width: 100%; margin-top: 12px; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);" onclick="burnTokens()" disabled>è¿æ¥é’±åŒ…åé”€æ¯</button>
            </div>

            <div style="text-align: center; margin: 20px 0; animation: bounce 2s infinite;">
                <div style="background: rgba(240, 185, 11, 0.9); color: #000; padding: 12px 24px; border-radius: 24px; font-size: 14px; font-weight: 700; display: inline-block; box-shadow: 0 4px 20px rgba(240, 185, 11, 0.4);">
                     åˆ†çº¢ï¼ˆç‚¹å‡»åº•éƒ¨"æˆ‘çš„"æŸ¥çœ‹ï¼‰
                </div>
            </div>
        </div>
    </div>

    <!-- å¤§å…é¡µ -->
    <div id="lobbyPage">
        <button class="back-btn" onclick="showPage('home')">â† è¿”å›</button>
        <div class="lobby-header">
            <div style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">ğŸ® æ¸¸æˆå¤§å…</div>
            <div style="font-size: 13px; color: rgba(255,255,255,0.5);">é€‰æ‹©æˆ¿é—´å¼€å§‹å¯¹æˆ˜ | åœ¨çº¿: <span id="onlineCount">128</span>äºº</div>
        </div>
        <div class="room-list">
            <div class="room-card coming-soon" onclick="showComingSoon()">
                <div class="room-icon">ğŸ¤–</div>
                <div class="room-info">
                    <div class="room-name">äººæœºå¯¹æˆ˜ <span style="font-size: 11px; color: #4ade80; background: rgba(74,222,128,0.2); padding: 2px 6px; border-radius: 8px;">å…¥é—¨</span></div>
                    <div class="room-meta"><span>åº•æ³¨: 10 æ–—å¸</span><span style="color: #fbbf24;">å¥–æ± : 2,450</span></div>
                </div>
                <div class="room-enter">ğŸ”’</div>
                <div class="room-tag">å³å°†ä¸Šçº¿</div>
            </div>
            <div class="room-card coming-soon" onclick="showComingSoon()">
                <div class="room-icon" style="background: linear-gradient(135deg, rgba(251,191,36,0.2) 0%, rgba(251,191,36,0.1) 100%);">âš¡</div>
                <div class="room-info">
                    <div class="room-name">é«˜çº§åœº <span style="font-size: 11px; color: #fbbf24; background: rgba(251,191,36,0.2); padding: 2px 6px; border-radius: 8px;">è¿›é˜¶</span></div>
                    <div class="room-meta"><span>åº•æ³¨: 100 æ–—å¸</span><span style="color: #fbbf24;">å¥–æ± : 15,680</span></div>
                </div>
                <div class="room-enter" style="background: rgba(251,191,36,0.2); color: #fbbf24;">ğŸ”’</div>
                <div class="room-tag">å³å°†ä¸Šçº¿</div>
            </div>
            <div class="room-card coming-soon" onclick="showComingSoon()">
                <div class="room-icon" style="background: linear-gradient(135deg, rgba(248,113,113,0.2) 0%, rgba(248,113,113,0.1) 100%);">ğŸ”¥</div>
                <div class="room-info">
                    <div class="room-name">åœŸè±ªåœº <span style="font-size: 11px; color: #f87171; background: rgba(248,113,113,0.2); padding: 2px 6px; border-radius: 8px;">å›°éš¾</span></div>
                    <div class="room-meta"><span>åº•æ³¨: 1000 æ–—å¸</span><span style="color: #fbbf24;">å¥–æ± : 88,888</span></div>
                </div>
                <div class="room-enter" style="background: rgba(248,113,113,0.2); color: #f87171;">ğŸ”’</div>
                <div class="room-tag">å³å°†ä¸Šçº¿</div>
            </div>
            <div class="room-card coming-soon" onclick="showComingSoon()">
                <div class="room-icon" style="background: linear-gradient(135deg, rgba(139,92,246,0.2) 0%, rgba(139,92,246,0.1) 100%);">ğŸ‘¥</div>
                <div class="room-info">
                    <div class="room-name" style="color: #a78bfa;">çœŸäººå¯¹æˆ˜ <span style="font-size: 11px; color: #a78bfa; background: rgba(139,92,246,0.2); padding: 2px 6px; border-radius: 8px;">PVP</span></div>
                    <div class="room-meta"><span style="color: #a78bfa;">å®æ—¶åŒ¹é… â€¢ 3äººæˆå±€</span></div>
                </div>
                <div class="room-enter" style="background: rgba(139,92,246,0.2); color: #a78bfa;">ğŸ”’</div>
                <div class="room-tag">å³å°†ä¸Šçº¿</div>
            </div>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œé¡µé¢ -->
    <div id="rankPage">
        <button class="back-btn" onclick="showPage('home')">â† è¿”å›</button>
        <div class="rank-header">
            <div style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">ğŸ† é”€æ¯æ’è¡Œæ¦œ</div>
            <div style="font-size: 13px; color: rgba(255,255,255,0.5);">æŒ‰é”€æ¯æ–—å¸æ•°é‡æ’è¡Œ | å®æ—¶æ›´æ–°</div>
        </div>
        <div class="rank-list" id="rankList"></div>
    </div>

    <!-- æˆ‘çš„é¡µé¢ï¼ˆåŒ…å«åˆ†çº¢æ¨¡å—ï¼‰ -->
    <div id="profilePage">
        <button class="back-btn" onclick="showPage('home')">â† è¿”å›</button>
        
        <div class="profile-header">
            <div class="profile-avatar">ğŸ‘¤</div>
            <div class="profile-address" id="profileAddress">æœªè¿æ¥é’±åŒ…</div>
            <div class="profile-balance" id="profileBalance">--</div>
            <div class="profile-label">æˆ‘çš„æ–—å¸ä½™é¢</div>
        </div>

        <div class="container" style="padding-bottom: 120px;">
            <div class="dividend-section" id="dividendSection">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #F0B90B 0%, #F8D12F 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold;">â‚¿</div>
                    <div>
                        <div style="font-weight: 600; color: #F0B90B;">WBNB åˆ†çº¢</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5);">é”€æ¯æ–—å¸è·å¾—WBNBæ”¶ç›Š</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid rgba(240, 185, 11, 0.1);">
                        <div style="font-size: 10px; color: rgba(255,255,255,0.5);">å¯é¢†å–</div>
                        <div style="font-size: 16px; font-weight: 700; color: #F0B90B; display: flex; align-items: center; justify-content: center; gap: 4px;">
                            <span id="pendingWBNB">0.0000</span>
                            <span style="font-size: 10px; color: rgba(240, 185, 11, 0.6);">WBNB</span>
                        </div>
                    </div>
                    <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid rgba(240, 185, 11, 0.1);">
                        <div style="font-size: 10px; color: rgba(255,255,255,0.5);">æ˜¨æ—¥æ”¶ç›Š</div>
                        <div style="font-size: 16px; font-weight: 700; color: #F0B90B; display: flex; align-items: center; justify-content: center; gap: 4px;">
                            <span id="yesterdayWBNB">0.0000</span>
                            <span style="font-size: 10px; color: rgba(240, 185, 11, 0.6);">WBNB</span>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-bottom: 12px; padding: 8px; background: rgba(240, 185, 11, 0.05); border-radius: 8px; font-size: 12px; color: rgba(255,255,255,0.6);">
                    ç´¯è®¡å·²é¢†å– <b id="totalClaimedWBNB" style="color: #F0B90B; font-size: 14px;">0.0000</b> WBNB
                </div>
                
                <button class="claim-btn" id="claimBtn" onclick="DividendAPI.claim()" disabled>è¿æ¥é’±åŒ…åé¢†å–</button>
            </div>

            <div class="glass-card">
                <div style="font-size: 14px; color: rgba(255,255,255,0.6); margin-bottom: 12px;">æˆ‘çš„æˆ˜ç»©</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center;">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; color: #4ade80;" id="totalGames">0</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.5);">æ€»åœºæ¬¡</div>
                    </div>
                    <div>
                        <div style="font-size: 20px; font-weight: 700; color: #fbbf24;" id="winRate">0%</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.5);">èƒœç‡</div>
                    </div>
                    <div>
                        <div style="font-size: 20px; font-weight: 700; color: #f87171;" id="totalProfit">0</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.5);">ç›ˆäº</div>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <div style="font-size: 14px; color: rgba(255,255,255,0.6); margin-bottom: 12px;">æˆ‘çš„é”€æ¯</div>
                <div style="font-size: 24px; font-weight: 700; color: #f87171; margin-bottom: 4px;" id="myBurnAmount">0 <span style="font-size: 14px;">æ–—å¸</span></div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.4);">é”€æ¯æ’åï¼šç¬¬ <span id="myBurnRank">--</span> ä½</div>
            </div>
        </div>
    </div>

    <!-- å…¨å±€åº•éƒ¨å¯¼èˆªæ  -->
    <div class="bottom-nav" id="globalBottomNav">
        <div class="nav-item active" id="navHome" onclick="showPage('home')">
            <span style="font-size: 20px;">ğŸ </span>
            <span>é¦–é¡µ</span>
        </div>
        <div class="nav-item" onclick="showPage('rank')">
            <span style="font-size: 20px;">ğŸ†</span>
            <span>æ’è¡Œ</span>
        </div>
        <div class="nav-main-btn" onclick="enterLobby()">â–¶</div>
        <div class="nav-item" id="navRank" onclick="showPage('rank')">
            <span style="font-size: 20px;">ğŸ“Š</span>
            <span>æ’è¡Œ</span>
        </div>
        <div class="nav-item" id="navProfile" onclick="showPage('profile')">
            <span style="font-size: 20px;">ğŸ‘¤</span>
            <span>æˆ‘çš„</span>
        </div>
    </div>

    <script>
        // ==================== åˆçº¦é…ç½®åŒºåŸŸï¼ˆé‡è¦ï¼è¯·ä¿®æ”¹è¿™é‡Œï¼‰ ====================
        const CONTRACT_CONFIG = {
            // æ›¿æ¢ä¸ºä½ çš„åˆçº¦åœ°å€
            address: "0x9a889E525FAEF4851bf5BEbfb5F294AC9D097777",
            
            // æ›¿æ¢ä¸ºä½ çš„åˆçº¦ABIï¼ˆä»è´è¶å¹³å°æˆ–BscScanå¤åˆ¶ï¼‰
            abi:[{"inputs":[{"components":[{"internalType":"address","name":"PCS_V2_FACTORY","type":"address"},{"internalType":"bytes32","name":"PCS_V2_CODE_HASH","type":"bytes32"},{"internalType":"address","name":"PCS_V2_ROUTER","type":"address"},{"internalType":"address","name":"PCS_SMART_ROUTER","type":"address"},{"internalType":"address","name":"WETH","type":"address"},{"internalType":"address","name":"PCS_V3_FACTORY","type":"address"},{"internalType":"bytes32","name":"PCS_V3_CODE_HASH","type":"bytes32"},{"internalType":"address","name":"UNI_V2_FACTORY","type":"address"},{"internalType":"bytes32","name":"UNI_V2_CODE_HASH","type":"bytes32"},{"internalType":"address","name":"UNI_V3_FACTORY","type":"address"},{"internalType":"bytes32","name":"UNI_V3_CODE_HASH","type":"bytes32"},{"internalType":"address","name":"PCS_V4_VAULT","type":"address"},{"internalType":"address","name":"UNI_V4_POOL","type":"address"},{"internalType":"uint256","name":"MIN_LIQ_THRESHOLD","type":"uint256"},{"internalType":"uint256","name":"START_LIQ_THRESHOLD","type":"uint256"},{"internalType":"uint256","name":"ANTI_FARMER_DURATION","type":"uint256"}],"internalType":"struct FlapTaxToken.ConstructorParams","name":"params","type":"tuple"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[],"name":"EIP712DomainChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"quoteToken","type":"address"},{"indexed":false,"internalType":"uint256","name":"taxAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"outputAmount","type":"uint256"}],"name":"FlapTaxLiquidationSuccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"fromState","type":"uint8"},{"indexed":false,"internalType":"uint8","name":"toState","type":"uint8"}],"name":"PoolStateChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes","name":"reason","type":"bytes"}],"name":"TaxLiquidationError","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferFlapToken","type":"event"},{"inputs":[],"name":"ANTI_FARMER_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DOMAIN_SEPARATOR","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_LIQ_THRESHOLD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"QUOTE_TOKEN","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"START_LIQ_THRESHOLD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TAX_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"antiFarmerExpirationTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"eip712Domain","outputs":[{"internalType":"bytes1","name":"fields","type":"bytes1"},{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"version","type":"string"},{"internalType":"uint256","name":"chainId","type":"uint256"},{"internalType":"address","name":"verifyingContract","type":"address"},{"internalType":"bytes32","name":"salt","type":"bytes32"},{"internalType":"uint256[]","name":"extensions","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"finalizeMigration","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"symbol","type":"string"},{"internalType":"string","name":"meta","type":"string"},{"internalType":"uint16","name":"tax","type":"uint16"},{"internalType":"address","name":"taxSplitter","type":"address"},{"internalType":"address","name":"quoteToken","type":"address"},{"internalType":"uint256","name":"liqExpectedOutputAmount","type":"uint256"},{"internalType":"uint256","name":"taxDuration","type":"uint256"}],"internalType":"struct IFlapTaxToken.InitParams","name":"params","type":"tuple"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"liqExpectedOutputAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"liquidationThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mainPool","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"metaURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"nonces","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint256","name":"deadline","type":"uint256"},{"internalType":"uint8","name":"v","type":"uint8"},{"internalType":"bytes32","name":"r","type":"bytes32"},{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"permit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"pools","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"startMigration","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"state","outputs":[{"internalType":"enum FlapTaxToken.PoolState","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxExpirationTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxRate","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxSplitter","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]
  

            
            // BSCä¸»ç½‘é…ç½®ï¼ˆå¦‚æœæ˜¯æµ‹è¯•ç½‘è¯·ä¿®æ”¹ï¼‰
            chainId: "0x38", // 56çš„åå…­è¿›åˆ¶
            chainName: "Binance Smart Chain",
            rpcUrl: "https://bsc-dataseed.binance.org/",
            nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 }
        };

        // ==================== å…¨å±€çŠ¶æ€ ====================
        const AppState = {
            provider: null,
            signer: null,
            contract: null,
            userAddress: null,
            isConnected: false,
            isAuthorized: false,
            tokenBalance: 0,
            pendingDividend: 0,
            totalBurned: 0
        };

        // ==================== Web3æ ¸å¿ƒåŠŸèƒ½ ====================
        
        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            const btn = document.getElementById('walletBtn');
            const originalContent = btn.innerHTML;
            
            try {
                // æ£€æŸ¥æ˜¯å¦å®‰è£…MetaMask
                if (!window.ethereum) {
                    showToast('è¯·å…ˆå®‰è£…MetaMaské’±åŒ…ï¼', 'error');
                    setTimeout(() => {
                        window.open('https://metamask.io/download.html', '_blank');
                    }, 2000);
                    return;
                }

                btn.innerHTML = '<div class="loading"></div>';
                
                // è¯·æ±‚è¿æ¥
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length === 0) {
                    throw new Error('æœªè·å¾—è´¦æˆ·æƒé™');
                }

                // åˆå§‹åŒ–Provider
                AppState.provider = new ethers.providers.Web3Provider(window.ethereum);
                AppState.signer = AppState.provider.getSigner();
                AppState.userAddress = accounts[0];
                AppState.isConnected = true;

                // æ£€æŸ¥ç½‘ç»œ
                await checkNetwork();
                
                // åˆå§‹åŒ–åˆçº¦
                initContract();
                
                // æ›´æ–°UI
                updateWalletUI();
                
                // åŠ è½½æ•°æ®
                await loadUserData();
                
                showToast('é’±åŒ…è¿æ¥æˆåŠŸï¼', 'success');
                
                // ç›‘å¬è´¦æˆ·å˜åŒ–
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => window.location.reload());
                
            } catch (error) {
                console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
                showToast('è¿æ¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                btn.innerHTML = originalContent;
            }
        }

        // æ£€æŸ¥å¹¶åˆ‡æ¢ç½‘ç»œ
        async function checkNetwork() {
            const chainId = await window.ethereum.request({ method: 'eth_chainId' });
            
            if (chainId !== CONTRACT_CONFIG.chainId) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: CONTRACT_CONFIG.chainId }],
                    });
                } catch (switchError) {
                    // å¦‚æœç½‘ç»œä¸å­˜åœ¨ï¼Œæ·»åŠ ç½‘ç»œ
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: CONTRACT_CONFIG.chainId,
                                chainName: CONTRACT_CONFIG.chainName,
                                rpcUrls: [CONTRACT_CONFIG.rpcUrl],
                                nativeCurrency: CONTRACT_CONFIG.nativeCurrency,
                                blockExplorerUrls: ['https://bscscan.com/']
                            }],
                        });
                    } else {
                        throw switchError;
                    }
                }
            }
        }

        // åˆå§‹åŒ–åˆçº¦
        function initContract() {
            if (!AppState.signer) return;
            
            AppState.contract = new ethers.Contract(
                CONTRACT_CONFIG.address,
                CONTRACT_CONFIG.abi,
                AppState.signer
            );
        }

        // å¤„ç†è´¦æˆ·å˜åŒ–
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                // ç”¨æˆ·æ–­å¼€äº†é’±åŒ…
                disconnectWallet();
            } else {
                AppState.userAddress = accounts[0];
                updateWalletUI();
                loadUserData();
            }
        }

        // æ–­å¼€é’±åŒ…ï¼ˆåˆ·æ–°é¡µé¢é‡ç½®ï¼‰
        function disconnectWallet() {
            window.location.reload();
        }

        // æ›´æ–°é’±åŒ…UI
        function updateWalletUI() {
            const btn = document.getElementById('walletBtn');
            const authSection = document.getElementById('authSection');
            const authBtn = document.getElementById('authBtn');
            const walletHint = document.getElementById('walletHint');
            const burnInput = document.getElementById('burnAmount');
            const burnAddBtns = document.querySelectorAll('.burn-add-btn');
            const burnBtn = document.getElementById('burnBtn');
            const claimBtn = document.getElementById('claimBtn');
            const profileAddr = document.getElementById('profileAddress');
            
            // é’±åŒ…å›¾æ ‡
            btn.classList.add('connected');
            btn.innerHTML = 'âœ“';
            btn.title = AppState.userAddress;
            
            // æ˜¾ç¤ºæˆæƒæŒ‰é’®
            if (authSection) authSection.style.display = 'block';
            if (walletHint) walletHint.style.display = 'block';
            if (authBtn) authBtn.disabled = false;
            
            // å¯ç”¨é”€æ¯åŠŸèƒ½
            if (burnInput) burnInput.disabled = false;
            burnAddBtns.forEach(b => b.disabled = false);
            if (burnBtn) {
                burnBtn.disabled = false;
                burnBtn.textContent = 'ç¡®è®¤é”€æ¯æ–—å¸';
            }
            
            // å¯ç”¨é¢†å–æŒ‰é’®
            if (claimBtn) {
                claimBtn.disabled = false;
                claimBtn.textContent = 'ğŸ’ é¢†å– WBNB åˆ†çº¢';
            }
            
            // æ›´æ–°ä¸ªäººèµ„æ–™é¡µåœ°å€
            if (profileAddr && AppState.userAddress) {
                profileAddr.textContent = AppState.userAddress.slice(0, 6) + '...' + AppState.userAddress.slice(-4);
            }
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®ï¼ˆä½™é¢ã€åˆ†çº¢ç­‰ï¼‰
        async function loadUserData() {
            if (!AppState.contract || !AppState.userAddress) return;
            
            try {
                // è·å–ä»£å¸ä½™é¢ï¼ˆå‡è®¾æ˜¯18ä½å°æ•°ï¼‰
                const balance = await AppState.contract.balanceOf(AppState.userAddress);
                AppState.tokenBalance = parseFloat(ethers.utils.formatUnits(balance, 18));
                
                document.getElementById('balance').textContent = AppState.tokenBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                document.getElementById('profileBalance').textContent = AppState.tokenBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                // è·å–å¾…é¢†å–åˆ†çº¢
                try {
                    const pending = await AppState.contract.pendingReward(AppState.userAddress);
                    AppState.pendingDividend = parseFloat(ethers.utils.formatUnits(pending, 18));
                    document.getElementById('pendingWBNB').textContent = AppState.pendingDividend.toFixed(4);
                } catch (e) {
                    console.log('è·å–åˆ†çº¢å¤±è´¥:', e);
                }
                
                // è·å–å·²é”€æ¯æ•°é‡
                try {
                    const burned = await AppState.contract.totalBurned(AppState.userAddress);
                    AppState.totalBurned = parseFloat(ethers.utils.formatUnits(burned, 18));
                    document.getElementById('myBurnAmount').textContent = AppState.totalBurned.toLocaleString('en-US', {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    });
                } catch (e) {
                    console.log('è·å–é”€æ¯æ•°é‡å¤±è´¥:', e);
                }
                
                // è·å–å¥–æ± ä½™é¢ï¼ˆä»åˆçº¦åœ°å€ï¼‰
                try {
                    const poolBalance = await AppState.contract.balanceOf(CONTRACT_CONFIG.address);
                    const poolAmount = parseFloat(ethers.utils.formatUnits(poolBalance, 18));
                    document.getElementById('aiPool').textContent = poolAmount.toLocaleString('en-US', {
                        maximumFractionDigits: 0
                    });
                } catch (e) {
                    document.getElementById('aiPool').textContent = '12,580';
                }
                
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                showToast('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
            }
        }

        // æˆæƒä»£å¸
        async function authorizeToken() {
            if (!AppState.isConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const btn = document.getElementById('authBtn');
            btn.innerHTML = '<div class="loading" style="width: 14px; height: 14px; border-width: 2px;"></div> æˆæƒä¸­...';
            btn.disabled = true;
            
            try {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„æˆæƒé€»è¾‘ï¼ˆapproveï¼‰
                // å¦‚æœéœ€è¦æˆæƒåˆçº¦æ“ä½œä»£å¸ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œ
                await new Promise(r => setTimeout(r, 1500)); // æ¨¡æ‹Ÿæˆæƒè¿‡ç¨‹
                
                AppState.isAuthorized = true;
                btn.innerHTML = 'âœ“ å·²æˆæƒ';
                btn.classList.add('authorized');
                showToast('æˆæƒæˆåŠŸï¼ç°åœ¨å¯ä»¥é”€æ¯ä»£å¸äº†', 'success');
            } catch (error) {
                console.error('æˆæƒå¤±è´¥:', error);
                btn.innerHTML = 'ğŸ”“ æˆæƒä»£å¸';
                btn.disabled = false;
                showToast('æˆæƒå¤±è´¥', 'error');
            }
        }

        // é”€æ¯ä»£å¸
        async function burnTokens() {
            if (!AppState.isConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            if (!AppState.isAuthorized) {
                showToast('è¯·å…ˆæˆæƒä»£å¸', 'error');
                return;
            }
            
            const input = document.getElementById('burnAmount');
            const amount = parseFloat(input.value);
            
            if (!amount || amount <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é”€æ¯æ•°é‡', 'error');
                return;
            }
            
            if (amount > AppState.tokenBalance) {
                showToast('ä½™é¢ä¸è¶³', 'error');
                return;
            }
            
            if (!confirm(`ç¡®å®šé”€æ¯ ${amount} æ–—å¸ï¼Ÿ\n\né”€æ¯åä¸å¯èµå›ï¼Œå°†è·å¾—ç›¸åº”åˆ†çº¢æƒã€‚`)) {
                return;
            }
            
            const btn = document.getElementById('burnBtn');
            btn.innerHTML = '<div class="loading"></div> é”€æ¯ä¸­...';
            btn.disabled = true;
            
            try {
                // è°ƒç”¨åˆçº¦çš„burnå‡½æ•°
                const tx = await AppState.contract.burn(
                    ethers.utils.parseUnits(amount.toString(), 18)
                );
                
                showToast('äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...', 'success');
                
                // ç­‰å¾…äº¤æ˜“ç¡®è®¤
                await tx.wait();
                
                showToast(`æˆåŠŸé”€æ¯ ${amount} æ–—å¸ï¼`, 'success');
                
                // é‡ç½®è¾“å…¥
                input.value = '100';
                
                // åˆ·æ–°æ•°æ®
                await loadUserData();
                
            } catch (error) {
                console.error('é”€æ¯å¤±è´¥:', error);
                showToast('é”€æ¯å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
            } finally {
                btn.innerHTML = 'ç¡®è®¤é”€æ¯æ–—å¸';
                btn.disabled = false;
            }
        }

        // é¢†å–åˆ†çº¢
        const DividendAPI = {
            claim: async function() {
                if (!AppState.isConnected) {
                    showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                    return;
                }
                
                if (AppState.pendingDividend <= 0) {
                    showToast('æš‚æ— å¯é¢†å–çš„åˆ†çº¢', 'error');
                    return;
                }
                
                const btn = document.getElementById('claimBtn');
                btn.innerHTML = '<div class="loading"></div> é¢†å–ä¸­...';
                btn.disabled = true;
                
                try {
                    const tx = await AppState.contract.claimReward();
                    showToast('äº¤æ˜“å·²æäº¤...', 'success');
                    await tx.wait();
                    
                    showToast(`æˆåŠŸé¢†å– ${AppState.pendingDividend.toFixed(4)} WBNBï¼`, 'success');
                    
                    // æ›´æ–°ç´¯è®¡é¢†å–
                    const totalEl = document.getElementById('totalClaimedWBNB');
                    const currentTotal = parseFloat(totalEl.textContent);
                    totalEl.textContent = (currentTotal + AppState.pendingDividend).toFixed(4);
                    
                    // åˆ·æ–°æ•°æ®
                    await loadUserData();
                    
                } catch (error) {
                    console.error('é¢†å–å¤±è´¥:', error);
                    showToast('é¢†å–å¤±è´¥', 'error');
                } finally {
                    btn.innerHTML = 'ğŸ’ é¢†å– WBNB åˆ†çº¢';
                    btn.disabled = false;
                }
            }
        };

        // ==================== UIåŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = 'normal') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(page) {
            const pages = {
                'home': 'homePage',
                'lobby': 'lobbyPage',
                'rank': 'rankPage',
                'profile': 'profilePage'
            };
            
            // éšè—æ‰€æœ‰
            Object.values(pages).forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            // æ˜¾ç¤ºç›®æ ‡
            if (pages[page]) {
                document.getElementById(pages[page]).style.display = 'block';
            }
            
            // æ›´æ–°å¯¼èˆª
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            const navMap = {
                'home': 'navHome',
                'rank': 'navRank',
                'profile': 'navProfile'
            };
            
            if (navMap[page]) {
                document.getElementById(navMap[page]).classList.add('active');
            }
            
            // ç‰¹æ®Šå¤„ç†
            if (page === 'rank') renderRankList();
            if (page === 'profile' && AppState.isConnected) loadUserData();
            
            window.scrollTo(0, 0);
        }

        // è¿›å…¥å¤§å…
        function enterLobby() {
            showPage('lobby');
        }

        // æ˜¾ç¤ºå³å°†ä¸Šçº¿æç¤º
        function showComingSoon() {
            showToast('ğŸ® æ¸¸æˆåŠŸèƒ½æœªå®Œå…¨å¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼', 'normal');
        }

        // é”€æ¯æ•°é‡é•¿æŒ‰å¢åŠ 
        let longPressTimer;
        function startLongPress(amount) {
            if (!AppState.isConnected) return;
            addBurn(amount);
            longPressTimer = setInterval(() => addBurn(amount), 150);
        }
        
        function stopLongPress() {
            clearInterval(longPressTimer);
        }
        
        function addBurn(amount) {
            const input = document.getElementById('burnAmount');
            let current = parseInt(input.value) || 0;
            input.value = current + amount;
        }

        // ==================== æ’è¡Œæ¦œæ•°æ® ====================
        const BurnRankData = [
            { address: '0x7a86...c0b0', amount: 528000, rank: 1 },
            { address: '0x9f12...3d4e', amount: 456000, rank: 2 },
            { address: '0x2b34...5f6a', amount: 389000, rank: 3 },
            { address: '0x1a2b...3c4d', amount: 245000, rank: 4 },
            { address: '0x5e6f...7a8b', amount: 198000, rank: 5 },
            { address: '0x9c8d...7e6f', amount: 156000, rank: 6 },
            { address: '0x3a4b...5c6d', amount: 124000, rank: 7 },
            { address: '0x7e8f...9a0b', amount: 98000, rank: 8 },
            { address: '0x2c3d...4e5f', amount: 87000, rank: 9 },
            { address: '0x6a7b...8c9d', amount: 65000, rank: 10 },
        ];

        function renderRankList() {
            const container = document.getElementById('rankList');
            if (!container) return;
            
            container.innerHTML = BurnRankData.map((item) => {
                let rankClass = 'rank-other';
                if (item.rank === 1) rankClass = 'rank-1';
                if (item.rank === 2) rankClass = 'rank-2';
                if (item.rank === 3) rankClass = 'rank-3';
                
                return `
                    <div class="rank-item">
                        <div class="rank-number ${rankClass}">${item.rank}</div>
                        <div class="rank-address">${item.address}</div>
                        <div class="rank-amount">${item.amount.toLocaleString()} <span style="font-size: 12px; color: rgba(255,255,255,0.5);">æ–—å¸</span></div>
                    </div>
                `;
            }).join('');
        }

        // ==================== æ¨¡æ‹Ÿä»·æ ¼æ›´æ–° ====================
        const TokenPriceAPI = {
            currentPrice: 0.0856,
            changePercent: 5.23,
            updateDisplay: function() {
                const priceEl = document.getElementById('tokenPrice');
                const changeEl = document.getElementById('priceChange');
                if (priceEl) priceEl.textContent = '$' + this.currentPrice.toFixed(4);
                if (changeEl) {
                    const isUp = this.changePercent >= 0;
                    changeEl.textContent = (isUp ? '+' : '') + this.changePercent.toFixed(2) + '%';
                    changeEl.style.color = isUp ? '#4ade80' : '#f87171';
                }
            }
        };

        // ==================== åˆå§‹åŒ– ====================
        window.addEventListener('load', () => {
            TokenPriceAPI.updateDisplay();
            renderRankList();
            
            // æ¨¡æ‹Ÿä»·æ ¼å˜åŠ¨
            setInterval(() => {
                const change = (Math.random() - 0.5) * 0.001;
                TokenPriceAPI.currentPrice = Math.max(0.01, TokenPriceAPI.currentPrice + change);
                TokenPriceAPI.changePercent = (change / TokenPriceAPI.currentPrice) * 100;
                TokenPriceAPI.updateDisplay();
            }, 10000);
            
            console.log('App initialized. Please connect wallet to use full features.');
        });
    </script>
</body>
</html>
