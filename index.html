<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title>è¸é©¬å°ç¥æ–—åœ°ä¸»</title>
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
    <script src="abi.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif; 
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); 
            min-height: 100vh; 
            color: #1a1a1a; 
            overflow-x: hidden;
            padding-bottom: 90px;
        }
        
        @media (min-width: 768px) {
            body { display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background: #f0f0f0; }
            .mobile-container { width: 100%; max-width: 480px; background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); min-height: 100vh; position: relative; box-shadow: 0 0 40px rgba(0,0,0,0.1); }
        }
        
        /* é¡µé¢å®¹å™¨ */
        #homePage, #burnPage, #claimPage, #gamePage, #rankPage { min-height: 100vh; display: none; position: relative; }
        #homePage { display: block; animation: fadeIn 0.4s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .brand { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .top-title { font-size: 18px; font-weight: 700; position: absolute; left: 50%; transform: translateX(-50%); }
        .top-action { font-size: 14px; font-weight: 600; color: #666; cursor: pointer; }
        
        .back-btn { width: 36px; height: 36px; border-radius: 50%; background: rgba(0,0,0,0.05); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; color: #1a1a1a; }
        
        .wallet-btn { width: 40px; height: 40px; border-radius: 50%; background: #1a1a1a; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; font-size: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .wallet-btn.connected { background: linear-gradient(135deg, #00d26a 0%, #00a854 100%); }
        
        /* ä¸»å†…å®¹åŒº */
        .container { max-width: 480px; margin: 0 auto; padding: 0 16px; }
        
        /* ç¬¬ä¸€è¡Œï¼šä½™é¢ + AIæ± ï¼ˆåŒå¡ç‰‡å¸ƒå±€ï¼‰ */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 16px 0; }
        .stat-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05); }
        .stat-label { font-size: 12px; color: #999; margin-bottom: 6px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 22px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.5px; }
        .stat-sub { font-size: 11px; color: #00a854; margin-top: 4px; font-weight: 600; }
        
        /* ç¬¬äºŒè¡Œï¼šä»Šæ—¥å¸ä»·ï¼ˆå…¨å®½é•¿æ¡ï¼‰ */
        .price-section-full { margin: 0 0 16px; }
        .price-module-full { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); 
            border: 1px solid rgba(0,0,0,0.05); 
            display: flex; 
            align-items: center;
            justify-content: space-between;
        }
        .price-left { flex: 1; }
        .price-header-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .price-title-text { font-size: 12px; color: #666; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .price-change-full { font-size: 12px; font-weight: 700; color: #00a854; background: rgba(0,168,84,0.1); padding: 4px 8px; border-radius: 12px; }
        .price-change-full.down { color: #dc2626; background: rgba(220,38,38,0.1); }
        .price-value-full { font-size: 28px; font-weight: 800; color: #1a1a1a; letter-spacing: -0.5px; }
        .price-chart-full { width: 100px; height: 40px; }
        .price-chart-full svg { width: 100%; height: 100%; }
        
        /* ç¬¬ä¸‰è¡Œï¼šæ–—åœ°ä¸»æ¸¸æˆå…¥å£ï¼ˆå…¨å®½å¤§æ¨¡å—ï¼‰ */
        .game-section-full { margin-bottom: 20px; }
        .game-module-full { 
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
            border-radius: 24px; 
            padding: 32px 24px; 
            color: white; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            text-align: center; 
            position: relative; 
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .game-module-full:active { transform: scale(0.98); }
        .game-module-full::before { content: 'â™ ï¸'; position: absolute; top: -10px; right: -10px; font-size: 80px; opacity: 0.05; }
        .game-module-full::after { content: 'â™¥ï¸'; position: absolute; bottom: -20px; left: -20px; font-size: 100px; opacity: 0.03; }
        
        .game-status-full { font-size: 11px; opacity: 0.8; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .game-title-full { font-size: 24px; font-weight: 800; margin-bottom: 6px; position: relative; z-index: 1; }
        .game-desc-full { font-size: 13px; opacity: 0.8; margin-bottom: 20px; position: relative; z-index: 1; }
        .play-btn-full { 
            background: white; 
            color: #1a1a1a; 
            border: none; 
            padding: 14px 32px; 
            border-radius: 24px; 
            font-size: 15px; 
            font-weight: 700; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            position: relative; 
            z-index: 1;
            display: inline-block;
        }
        
        /* ç‡ƒçƒ§é¡µé¢ */
        .page-header-simple { padding: 20px; text-align: center; }
        .page-title-simple { font-size: 28px; font-weight: 800; margin-bottom: 4px; color: #1a1a1a; }
        .page-subtitle-simple { font-size: 14px; color: #666; }
        
        .input-card { background: white; border-radius: 24px; padding: 28px 20px; margin: 0 0 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); text-align: center; }
        .input-label { font-size: 13px; color: #999; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .big-input { width: 100%; border: none; font-size: 42px; font-weight: 700; text-align: center; color: #1a1a1a; outline: none; margin-bottom: 16px; font-family: inherit; }
        .big-input::placeholder { color: #ddd; }
        
        .quick-buttons { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .quick-btn { background: #f5f5f5; border: 2px solid transparent; color: #1a1a1a; padding: 10px 16px; border-radius: 14px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; user-select: none; }
        .quick-btn:active { transform: scale(0.95); background: #e5e5e5; }
        .quick-btn.active-long { background: #1a1a1a; color: white; border-color: #1a1a1a; }
        
        .action-btn { width: 100%; background: #1a1a1a; color: white; border: none; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .action-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .action-btn:active:not(:disabled) { transform: scale(0.98); }
        .action-btn.burn { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
        .action-btn.claim { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 16px; }
        .info-card { background: #fafafa; border-radius: 14px; padding: 14px; text-align: center; }
        .info-label { font-size: 11px; color: #999; margin-bottom: 4px; font-weight: 500; }
        .info-value { font-size: 16px; font-weight: 700; color: #1a1a1a; }
        
        /* ä¼˜åŒ–åçš„é¢†å–åˆ†çº¢é¡µé¢ - ç´§å‡‘ç‰ˆ */
        .claim-container { padding: 16px; }
        .claim-header { background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%); border: 1px solid rgba(245,158,11,0.2); border-radius: 20px; padding: 24px; text-align: center; margin-bottom: 16px; box-shadow: 0 4px 20px rgba(245,158,11,0.1); }
        .claim-label { font-size: 12px; color: #92400e; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .claim-amount { font-size: 36px; font-weight: 800; color: #b45309; margin-bottom: 4px; letter-spacing: -1px; }
        .claim-unit { font-size: 14px; color: #d97706; font-weight: 600; margin-bottom: 20px; }
        .claim-btn { width: 100%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(245,158,11,0.3); }
        .claim-btn:disabled { opacity: 0.5; background: #ccc; box-shadow: none; cursor: not-allowed; }
        
        .claim-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }
        .claim-stat-item { background: white; border-radius: 12px; padding: 12px 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .claim-stat-label { font-size: 10px; color: #999; margin-bottom: 4px; }
        .claim-stat-value { font-size: 13px; font-weight: 700; color: #1a1a1a; }
        
        .claim-rule { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); font-size: 12px; color: #666; line-height: 1.6; text-align: center; }
        .claim-rule-title { font-weight: 700; color: #1a1a1a; margin-bottom: 6px; font-size: 13px; }
        
        /* æ¸¸æˆé¡µé¢ */
        .game-table { position: relative; height: calc(100vh - 200px); display: flex; flex-direction: column; }
        
        /* AIç©å®¶ */
        .ai-players { display: flex; justify-content: space-between; padding: 20px 40px; position: relative; }
        .ai-player { text-align: center; }
        .ai-avatar { width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%); display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 3px solid white; position: relative; }
        .ai-avatar.landlord::after { content: 'ğŸ‘‘'; position: absolute; top: -5px; right: -5px; font-size: 16px; background: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .ai-avatar.active { border-color: #00d26a; box-shadow: 0 0 0 3px rgba(0,210,106,0.2); }
        .ai-name { font-size: 13px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px; }
        .ai-count { font-size: 11px; color: #999; background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 10px; display: inline-block; }
        .ai-status { font-size: 10px; color: #00a854; margin-top: 4px; font-weight: 600; }
        
        /* ç‰Œæ¡Œä¸­å¤® */
        .table-center { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .pot-info { background: rgba(0,0,0,0.8); color: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 20px; }
        .last-play-area { min-height: 100px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: -5px; margin-bottom: 20px; }
        .card-played { width: 40px; height: 56px; background: white; border-radius: 6px; border: 1px solid #ddd; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-right: -10px; }
        .card-red { color: #dc2626; }
        .card-black { color: #1a1a1a; }
        .play-info { font-size: 13px; color: #666; text-align: center; }
        
        /* ç©å®¶åŒºåŸŸ */
        .player-area { background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.9) 20%, #ffffff 100%); padding: 20px 16px 30px; position: fixed; bottom: 80px; left: 0; right: 0; z-index: 10; }
        .player-hand { display: flex; justify-content: center; gap: 6px; margin-bottom: 16px; overflow-x: auto; padding: 10px 0; }
        .hand-card { width: 44px; height: 62px; background: white; border-radius: 6px; border: 1px solid #e0e0e0; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(0,0,0,0.08); position: relative; }
        .hand-card.selected { transform: translateY(-15px); border-color: #00d26a; box-shadow: 0 4px 12px rgba(0,210,106,0.3); }
        .hand-card.back { background: linear-gradient(135deg, #1a3a8f 0%, #2d5bc6 100%); border: none; }
        
        .game-controls { display: flex; gap: 10px; justify-content: center; }
        .game-btn { padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 700; cursor: pointer; border: none; transition: all 0.3s; }
        .game-btn-primary { background: #1a1a1a; color: white; flex: 1; max-width: 120px; }
        .game-btn-secondary { background: #f5f5f5; color: #666; border: 1px solid #e0e0e0; }
        .game-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* æ’è¡Œé¡µé¢ */
        .rank-header { padding: 60px 20px 20px; text-align: center; background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%); }
        .rank-title { font-size: 28px; font-weight: 800; margin-bottom: 4px; }
        .rank-subtitle { font-size: 14px; color: #666; }
        
        .rank-tabs { display: flex; padding: 0 20px; margin-bottom: 16px; gap: 10px; }
        .rank-tab { flex: 1; padding: 12px; border-radius: 12px; border: none; background: #f5f5f5; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; }
        .rank-tab.active { background: #1a1a1a; color: white; }
        
        .rank-list { padding: 0 16px; }
        .rank-item { display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 16px; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .rank-number { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; margin-right: 12px; background: #f5f5f5; color: #666; }
        .rank-number.top1 { background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #8b6914; }
        .rank-number.top2 { background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); color: #666; }
        .rank-number.top3 { background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%); color: white; }
        
        .rank-info { flex: 1; }
        .rank-address { font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 2px; }
        .rank-amount { font-size: 12px; color: #666; }
        .rank-reward { font-size: 14px; font-weight: 700; color: #00a854; }
        
        .my-rank { position: fixed; bottom: 90px; left: 16px; right: 16px; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: white; padding: 16px 20px; border-radius: 16px; display: flex; align-items: center; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .my-rank-label { font-size: 12px; opacity: 0.8; margin-bottom: 2px; }
        .my-rank-value { font-size: 16px; font-weight: 700; }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.98); backdrop-filter: blur(20px); border-radius: 30px; padding: 10px 14px; display: flex; gap: 6px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 1px solid rgba(0,0,0,0.05); z-index: 1000; max-width: 95%; }
        @media (min-width: 768px) { .bottom-nav { position: absolute; } }
        
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 3px; padding: 8px 14px; border-radius: 18px; cursor: pointer; transition: all 0.3s; min-width: 56px; color: #999; font-size: 10px; font-weight: 600; border: none; background: transparent; }
        .nav-item.active { background: #1a1a1a; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .nav-icon { font-size: 18px; line-height: 1; }
        
        /* æç¤º */
        .tx-toast { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(26,26,26,0.95); color: white; padding: 14px 24px; border-radius: 14px; font-size: 14px; font-weight: 500; z-index: 10000; display: none; backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 90%; text-align: center; }
        .tx-toast.show { display: block; }
        .tx-toast.error { background: rgba(220,38,38,0.95); }
        
        .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .network-badge { position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: #1a1a1a; color: white; padding: 10px 20px; border-radius: 20px; font-size: 13px; font-weight: 600; z-index: 9999; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .network-badge.show { display: block; }
        
        .warning-box { background: #fffbeb; border: 1px solid #f59e0b; border-radius: 14px; padding: 14px; margin: 16px; font-size: 13px; color: #92400e; }
        
        .auth-section { position: fixed; top: 80px; right: 16px; z-index: 100; }
        @media (min-width: 768px) { .auth-section { position: absolute; } }
        .auth-btn { background: #1a1a1a; color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .auth-btn.authorized { background: #00d26a; }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div id="networkBadge" class="network-badge">è¯·åˆ‡æ¢ç½‘ç»œ</div>
        <div id="txToast" class="tx-toast"></div>

        <!-- é¦–é¡µ -->
        <div id="homePage">
            <div class="top-nav">
                <div class="brand">è¸é©¬å°ç¥</div>
                <button class="wallet-btn" id="walletBtn" onclick="connectWallet()">ğŸ’¼</button>
            </div>
            
            <div id="authSection" class="auth-section" style="display: none;">
                <button class="auth-btn" id="authBtn" onclick="authorizeToken()">æˆæƒ</button>
            </div>

            <div class="container">
                <!-- ç¬¬ä¸€è¡Œï¼šä½™é¢ + AIæ± ï¼ˆæŒ‰æ‰‹ç»˜å›¾ï¼šå·¦ä½™é¢ï¼Œå³AIæ± ï¼‰ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æˆ‘çš„ä½™é¢</div>
                        <div class="stat-value" id="balance">0.00</div>
                        <div class="stat-sub" id="tokenSymbolDisplay">TMFS</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">AIå¥–æ± </div>
                        <div class="stat-value" id="aiPoolAmount">0.00</div>
                        <div class="stat-sub">å®æ—¶ç´¯ç§¯</div>
                    </div>
                </div>

                <!-- ç¬¬äºŒè¡Œï¼šä»Šæ—¥å¸ä»·ï¼ˆå…¨å®½é•¿æ¡ï¼‰ -->
                <div class="price-section-full">
                    <div class="price-module-full">
                        <div class="price-left">
                            <div class="price-header-row">
                                <div class="price-title-text">ä»Šæ—¥å¸ä»·</div>
                                <div class="price-change-full" id="priceChange">+5.24%</div>
                            </div>
                            <div class="price-value-full" id="tokenPrice">$0.0042</div>
                        </div>
                        <div class="price-chart-full">
                            <svg viewBox="0 0 200 40" preserveAspectRatio="none">
                                <path d="M0,30 Q25,28 50,25 T100,20 T150,15 T200,10" fill="none" stroke="#00a854" stroke-width="2" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- ç¬¬ä¸‰è¡Œï¼šæ–—åœ°ä¸»æ¸¸æˆå…¥å£ï¼ˆå…¨å®½å¤§æ–¹å—ï¼‰ -->
                <div class="game-section-full">
                    <div class="game-module-full" onclick="startGame()">
                        <div class="game-status-full">ğŸ”¥ çƒ­é—¨å¯¹æˆ˜</div>
                        <div class="game-title-full">å¼€å§‹æ–—åœ°ä¸»</div>
                        <div class="game-desc-full">1v2 AIå¯¹æˆ˜ | èµ¢å–ä»£å¸å¥–åŠ±</div>
                        <button class="play-btn-full">ç«‹å³å¼€å§‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆé¡µé¢ -->
        <div id="gamePage">
            <div class="top-nav">
                <button class="back-btn" onclick="exitGame()">â†</button>
                <div class="top-title">æˆ¿é—´ #<span id="gameRoomId">001</span></div>
                <div class="top-action" id="gamePot">å¥–æ± : 0 TMFS</div>
            </div>

            <div class="game-table">
                <div class="ai-players">
                    <div class="ai-player" id="aiLeft">
                        <div class="ai-avatar">ğŸ¤–</div>
                        <div class="ai-name">AI-æç™½</div>
                        <div class="ai-count" id="aiLeftCards">17å¼ </div>
                        <div class="ai-status" id="aiLeftStatus">æ€è€ƒä¸­...</div>
                    </div>
                    <div class="ai-player" id="aiRight">
                        <div class="ai-avatar">ğŸ¤–</div>
                        <div class="ai-name">AI-æœç”«</div>
                        <div class="ai-count" id="aiRightCards">17å¼ </div>
                        <div class="ai-status" id="aiRightStatus">ç­‰å¾…ä¸­</div>
                    </div>
                </div>

                <div class="table-center">
                    <div class="pot-info" id="centerPot">ğŸ’° å¥–æ± : 0 TMFS | å€æ•°: x1</div>
                    <div class="last-play-area" id="lastPlayArea">
                        <div class="play-info">ç‚¹å‡»"å¼€å§‹å¯¹æˆ˜"å¼€å§‹æ¸¸æˆ</div>
                    </div>
                    <div class="play-info" id="turnInfo">ç­‰å¾…ç©å®¶åŠ å…¥...</div>
                </div>
            </div>

            <div class="player-area">
                <div class="player-hand" id="playerHand">
                    <!-- æ‰‹ç‰ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="game-controls" id="gameControls" style="display: none;">
                    <button class="game-btn game-btn-secondary" onclick="skipTurn()">è·³è¿‡</button>
                    <button class="game-btn game-btn-primary" onclick="playCards()">å‡ºç‰Œ</button>
                </div>
                <div class="game-controls" id="startControl">
                    <button class="game-btn game-btn-primary" onclick="startGame()" style="max-width: 200px;">å¼€å§‹å¯¹æˆ˜ (è´¨æŠ¼ 100 TMFS)</button>
                </div>
            </div>
        </div>

        <!-- ç‡ƒçƒ§é¡µé¢ -->
        <div id="burnPage">
            <div class="top-nav">
                <button class="back-btn" onclick="showPage('home')">â†</button>
                <div class="top-title">ç‡ƒçƒ§ä»£å¸</div>
                <div style="width: 40px;"></div>
            </div>

            <div class="container" style="padding-top: 20px;">
                <div class="input-card">
                    <div class="input-label">ç‡ƒçƒ§æ•°é‡ (TMFS)</div>
                    <input type="number" class="big-input" id="burnAmountInput" placeholder="0" value="0">
                    
                    <div class="quick-buttons">
                        <button class="quick-btn" ontouchstart="startLongPress(this, 1000)" ontouchend="endLongPress()" onmousedown="startLongPress(this, 1000)" onmouseup="endLongPress()" onmouseleave="endLongPress()">+1k</button>
                        <button class="quick-btn" ontouchstart="startLongPress(this, 10000)" ontouchend="endLongPress()" onmousedown="startLongPress(this, 10000)" onmouseup="endLongPress()" onmouseleave="endLongPress()">+1w</button>
                        <button class="quick-btn" ontouchstart="startLongPress(this, 100000)" ontouchend="endLongPress()" onmousedown="startLongPress(this, 100000)" onmouseup="endLongPress()" onmouseleave="endLongPress()">+10w</button>
                    </div>
                    
                    <button class="action-btn burn" onclick="burnTokens()" id="burnBtn">ç¡®è®¤é”€æ¯</button>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">æˆ‘çš„ç´¯è®¡ç‡ƒçƒ§</div>
                        <div class="info-value" id="myTotalBurned">0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">å…¨çƒç‡ƒçƒ§æ€»é‡</div>
                        <div class="info-value" id="globalBurned">0</div>
                    </div>
                </div>

                <div id="dividendWarning" class="warning-box" style="display: none;">
                    <b>âš ï¸ éœ€è¦é…ç½®åˆ†çº¢åˆçº¦</b><br>
                    è¯·åœ¨ abi.js ä¸­é…ç½® dividendAddress å’Œ dividendABI
                </div>
            </div>
        </div>

        <!-- é¢†å–åˆ†çº¢é¡µé¢ - ä¼˜åŒ–ç´§å‡‘ç‰ˆ -->
        <div id="claimPage">
            <div class="top-nav">
                <button class="back-btn" onclick="showPage('home')">â†</button>
                <div class="top-title">é¢†å–åˆ†çº¢</div>
                <div style="width: 40px;"></div>
            </div>

            <div class="claim-container">
                <div class="claim-header">
                    <div class="claim-label">å¯é¢†å– WBNB</div>
                    <div class="claim-amount" id="pendingWBNB">0.0000</div>
                    <div class="claim-unit">WBNB</div>
                    <button class="claim-btn" id="claimBtn" onclick="claimDividend()" disabled>é¢†å–åˆ†çº¢</button>
                </div>

                <div class="claim-stats">
                    <div class="claim-stat-item">
                        <div class="claim-stat-label">å·²é¢†å–</div>
                        <div class="claim-stat-value" id="totalClaimedWBNB">0</div>
                    </div>
                    <div class="claim-stat-item">
                        <div class="claim-stat-label">ç§¯åˆ†</div>
                        <div class="claim-stat-value" id="dividendPoints">0</div>
                    </div>
                    <div class="claim-stat-item">
                        <div class="claim-stat-label">æˆ‘çš„ç‡ƒçƒ§</div>
                        <div class="claim-stat-value" id="myBurnAmount">0</div>
                    </div>
                    <div class="claim-stat-item">
                        <div class="claim-stat-label">å…¨çƒç‡ƒçƒ§</div>
                        <div class="claim-stat-value" id="globalBurnAmount">0</div>
                    </div>
                </div>

                <div class="claim-rule">
                    <div class="claim-rule-title">ğŸ’¡ åˆ†çº¢è§„åˆ™</div>
                    é”€æ¯ TMFS è·å¾—åˆ†çº¢ç§¯åˆ†ï¼Œæ¯æ—¥æŒ‰ç§¯åˆ†å æ¯”åˆ†é… WBNBï¼Œå¯éšæ—¶é¢†å–
                </div>
            </div>
        </div>

        <!-- æ’è¡Œé¡µé¢ -->
        <div id="rankPage">
            <div class="rank-header">
                <div class="rank-title">ğŸ† ç‡ƒçƒ§æ’è¡Œ</div>
                <div class="rank-subtitle">å…¨çƒ TMFS ç‡ƒçƒ§é‡æ’è¡Œæ¦œ</div>
            </div>

            <div class="rank-tabs">
                <button class="rank-tab active" onclick="switchRankTab('burn')">ç‡ƒçƒ§æ’è¡Œ</button>
                <button class="rank-tab" onclick="switchRankTab('reward')">æ”¶ç›Šæ’è¡Œ</button>
            </div>

            <div class="rank-list" id="rankList">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
                <div class="rank-item">
                    <div class="rank-number top1">1</div>
                    <div class="rank-info">
                        <div class="rank-address">0x8888...8888</div>
                        <div class="rank-amount">ç‡ƒçƒ§ 1,000,000 TMFS</div>
                    </div>
                    <div class="rank-reward">+5.2 BNB</div>
                </div>
                <div class="rank-item">
                    <div class="rank-number top2">2</div>
                    <div class="rank-info">
                        <div class="rank-address">0x7777...7777</div>
                        <div class="rank-amount">ç‡ƒçƒ§ 800,000 TMFS</div>
                    </div>
                    <div class="rank-reward">+4.1 BNB</div>
                </div>
                <div class="rank-item">
                    <div class="rank-number top3">3</div>
                    <div class="rank-info">
                        <div class="rank-address">0x6666...6666</div>
                        <div class="rank-amount">ç‡ƒçƒ§ 600,000 TMFS</div>
                    </div>
                    <div class="rank-reward">+3.2 BNB</div>
                </div>
                <!-- æ›´å¤šæ’å... -->
            </div>

            <div class="my-rank">
                <div style="flex: 1;">
                    <div class="my-rank-label">æˆ‘çš„æ’å</div>
                    <div class="my-rank-value" id="myRank">ç¬¬ 99+ å | ç‡ƒçƒ§ 0 TMFS</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 12px; opacity: 0.8;">é¢„è®¡æ”¶ç›Š</div>
                    <div style="font-size: 16px; font-weight: 700;" id="myRankReward">0 BNB</div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showPage('home')" data-page="home">
                <span class="nav-icon">ğŸ </span>
                <span>é¦–é¡µ</span>
            </button>
            <button class="nav-item" onclick="showPage('burn')" data-page="burn">
                <span class="nav-icon">ğŸ”¥</span>
                <span>ç‡ƒçƒ§</span>
            </button>
            <button class="nav-item" onclick="showPage('claim')" data-page="claim">
                <span class="nav-icon">ğŸ’</span>
                <span>é¢†åˆ†çº¢</span>
            </button>
            <button class="nav-item" onclick="showPage('rank')" data-page="rank">
                <span class="nav-icon">ğŸ†</span>
                <span>æ’è¡Œ</span>
            </button>
        </div>
    </div>

    <script>
        // ==================== é…ç½®æ£€æŸ¥ ====================
        if (!window.CONTRACT_CONFIG) {
            alert('é”™è¯¯ï¼šæœªæ‰¾åˆ° abi.js æ–‡ä»¶ï¼');
            throw new Error('CONTRACT_CONFIG not found');
        }

        const CONFIG = window.CONTRACT_CONFIG;
        const TOKEN_ABI = CONFIG.tokenABI;
        const DIVIDEND_ABI = CONFIG.dividendABI || [];
        const TOKEN_ADDRESS = CONFIG.tokenAddress;
        const DIVIDEND_ADDRESS = CONFIG.dividendAddress;
        const CHAIN_ID = CONFIG.chainId || "0x38";
        const CHAIN_NAME = CONFIG.chainName || "BSC Mainnet";
        const RPC_URL = CONFIG.rpcUrl || "https://bsc-dataseed.binance.org/";
        
        const HAS_DIVIDEND_CONTRACT = DIVIDEND_ADDRESS && DIVIDEND_ABI.length > 0;

        // ==================== å…¨å±€å˜é‡ ====================
        let provider = null;
        let signer = null;
        let tokenContract = null;
        let dividendContract = null;
        let gameContract = null; // TODO: Contract Call - æ¸¸æˆåˆçº¦å®ä¾‹
        let userAddress = null;
        let tokenDecimals = CONFIG.decimals || 18;
        let tokenSymbol = "TMFS";
        let longPressTimer = null;
        let longPressInterval = null;
        const LONG_PRESS_DELAY = 500;
        let selectedCards = []; // é€‰ä¸­çš„ç‰Œç´¢å¼•

        // ==================== å·¥å…·å‡½æ•° ====================
        function showToast(message, isError = false) {
            const toast = document.getElementById('txToast');
            toast.textContent = message;
            toast.className = 'tx-toast ' + (isError ? 'error' : '') + ' show';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function formatAddress(address) {
            if (!address || address === '0x0000000000000000000000000000000000000000') return 'æ— ';
            return address.slice(0, 6) + '...' + address.slice(-4);
        }

        function formatAmount(amount, decimals = 2) {
            if (!amount || amount === '0') return '0.'.padEnd(decimals + 2, '0');
            return parseFloat(amount).toFixed(decimals);
        }

        // ==================== ä»·æ ¼æŸ¥è¯¢ ====================
        async function fetchTokenPrice() {
            // TODO: Contract Call - ä»åˆçº¦æˆ–ä»·æ ¼é¢„è¨€æœºæŸ¥è¯¢TMFSå®æ—¶ä»·æ ¼
            // å»ºè®®æ¥å£: 
            // 1. è°ƒç”¨ DEX Router (PancakeSwap) getAmountsOut æŸ¥è¯¢1TMFSå¯¹USDTä»·æ ¼
            // 2. æˆ–è°ƒç”¨è‡ªå®šä¹‰ PriceOracle åˆçº¦ getPrice()
            // 3. æˆ–ä»åç«¯APIè·å–
            
            try {
                // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”ä»åˆçº¦è·å–
                const mockPrice = 0.0042;
                const mockChange = 5.24;
                
                document.getElementById('tokenPrice').textContent = '$' + mockPrice.toFixed(4);
                const changeEl = document.getElementById('priceChange');
                changeEl.textContent = (mockChange > 0 ? '+' : '') + mockChange + '%';
                changeEl.className = 'price-change-full ' + (mockChange < 0 ? 'down' : '');
                
            } catch (error) {
                console.error('è·å–ä»·æ ¼å¤±è´¥:', error);
            }
        }

        // ==================== é•¿æŒ‰åŠŸèƒ½ ====================
        function startLongPress(btn, amount) {
            btn.classList.add('active-long');
            addToBurnInput(amount);
            
            longPressTimer = setTimeout(() => {
                longPressInterval = setInterval(() => {
                    addToBurnInput(amount);
                }, 100);
            }, LONG_PRESS_DELAY);
        }

        function endLongPress() {
            if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; }
            if (longPressInterval) { clearInterval(longPressInterval); longPressInterval = null; }
            document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active-long'));
        }

        function addToBurnInput(amount) {
            const input = document.getElementById('burnAmountInput');
            const current = parseFloat(input.value) || 0;
            input.value = current + amount;
        }

        // ==================== é’±åŒ…è¿æ¥ ====================
        async function connectWallet() {
            if (!window.ethereum) { alert('è¯·å®‰è£… MetaMaskï¼'); return; }
            
            const btn = document.getElementById('walletBtn');
            btn.innerHTML = '<span class="loading"></span>';
            
            try {
                // æ£€æŸ¥ç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== CHAIN_ID) {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: CHAIN_ID }]
                    });
                }
                
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();
                
                // åˆå§‹åŒ–åˆçº¦
                tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
                if (HAS_DIVIDEND_CONTRACT) {
                    dividendContract = new ethers.Contract(DIVIDEND_ADDRESS, DIVIDEND_ABI, signer);
                }
                
                // TODO: Contract Call - åˆå§‹åŒ–æ¸¸æˆåˆçº¦
                // gameContract = new ethers.Contract(GAME_ADDRESS, GAME_ABI, signer);
                
                btn.classList.add('connected');
                btn.innerHTML = 'âœ“';
                document.getElementById('authSection').style.display = 'block';
                
                await loadAllData();
                showToast(`å·²è¿æ¥: ${tokenSymbol}`);
                
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                btn.innerHTML = 'ğŸ’¼';
                showToast('è¿æ¥å¤±è´¥: ' + error.message, true);
            }
        }

        // ==================== æ•°æ®åŠ è½½ ====================
        async function loadAllData() {
            if (!tokenContract || !userAddress) return;
            
            try {
                // TODO: Contract Call - è·å–ç”¨æˆ·ä½™é¢
                const balance = await tokenContract.balanceOf(userAddress);
                document.getElementById('balance').textContent = formatAmount(ethers.formatUnits(balance, tokenDecimals));
                
                // TODO: Contract Call - è·å–AIå¥–æ± ä½™é¢ (ä»æ¸¸æˆåˆçº¦æˆ–å¥–æ± åˆçº¦)
                const totalSupply = await tokenContract.totalSupply();
                document.getElementById('aiPoolAmount').textContent = formatAmount(ethers.formatUnits(totalSupply, tokenDecimals) * 0.01);
                
                await checkAllowance();
                
                if (HAS_DIVIDEND_CONTRACT) {
                    await loadDividendData();
                }
                
                // TODO: Contract Call - è·å–å®æ—¶ä»·æ ¼
                await fetchTokenPrice();
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        async function checkAllowance() {
            if (!tokenContract || !userAddress) return;
            try {
                const spender = HAS_DIVIDEND_CONTRACT ? DIVIDEND_ADDRESS : TOKEN_ADDRESS;
                const allowance = await tokenContract.allowance(userAddress, spender);
                const btn = document.getElementById('authBtn');
                if (allowance > 0) { btn.textContent = 'å·²æˆæƒ'; btn.classList.add('authorized'); }
            } catch (error) { console.error('æ£€æŸ¥æˆæƒå¤±è´¥:', error); }
        }

        async function authorizeToken() {
            if (!tokenContract || !userAddress) { alert('è¯·å…ˆè¿æ¥é’±åŒ…'); return; }
            const btn = document.getElementById('authBtn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;
            try {
                const spender = HAS_DIVIDEND_CONTRACT ? DIVIDEND_ADDRESS : TOKEN_ADDRESS;
                const tx = await tokenContract.approve(spender, ethers.MaxUint256);
                showToast('æˆæƒäº¤æ˜“å·²å‘é€...');
                await tx.wait();
                showToast('æˆæƒæˆåŠŸï¼');
                await checkAllowance();
            } catch (error) {
                showToast('æˆæƒå¤±è´¥: ' + error.message, true);
            } finally { btn.disabled = false; }
        }

        // ==================== ç‡ƒçƒ§åŠŸèƒ½ ====================
        async function burnTokens() {
            if (!HAS_DIVIDEND_CONTRACT || !dividendContract) { showToast('æœªé…ç½®åˆ†çº¢åˆçº¦', true); return; }
            const amount = document.getElementById('burnAmountInput').value;
            if (!amount || amount <= 0) { showToast('è¯·è¾“å…¥æœ‰æ•ˆæ•°é‡', true); return; }
            
            const btn = document.getElementById('burnBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> å¤„ç†ä¸­...';
            
            try {
                const amountWei = ethers.parseUnits(amount.toString(), tokenDecimals);
                
                // TODO: Contract Call - æ£€æŸ¥ä½™é¢
                const balance = await tokenContract.balanceOf(userAddress);
                if (balance < amountWei) throw new Error('ä½™é¢ä¸è¶³');
                
                // TODO: Contract Call - æ£€æŸ¥æˆæƒå¹¶æ‰§è¡Œburn
                const allowance = await tokenContract.allowance(userAddress, DIVIDEND_ADDRESS);
                if (allowance < amountWei) {
                    showToast('æ­£åœ¨æˆæƒ...');
                    const approveTx = await tokenContract.approve(DIVIDEND_ADDRESS, ethers.MaxUint256);
                    await approveTx.wait();
                }
                
                const tx = await dividendContract.burn(amountWei);
                showToast('é”€æ¯äº¤æ˜“å·²å‘é€...');
                await tx.wait();
                
                await loadAllData();
                document.getElementById('burnAmountInput').value = '0';
                showToast(`æˆåŠŸé”€æ¯ ${amount} ${tokenSymbol}ï¼`);
                
            } catch (error) {
                showToast('é”€æ¯å¤±è´¥: ' + error.message, true);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ç¡®è®¤é”€æ¯';
            }
        }

        // ==================== åˆ†çº¢åŠŸèƒ½ ====================
        async function loadDividendData() {
            if (!HAS_DIVIDEND_CONTRACT || !dividendContract || !userAddress) return;
            try {
                // TODO: Contract Call - è·å–å¯é¢†å–åˆ†çº¢
                const pending = await dividendContract.check(userAddress).catch(() => 0);
                // TODO: Contract Call - è·å–ç”¨æˆ·ç§¯åˆ†
                const points = await dividendContract.points(userAddress).catch(() => 0);
                // TODO: Contract Call - è·å–å·²é¢†å–ç´¯è®¡
                const claimed = await dividendContract.claimed(userAddress).catch(() => 0);
                // TODO: Contract Call - è·å–å…¨çƒç‡ƒçƒ§æ€»é‡
                const totalBurned = await dividendContract.totalBurned().catch(() => 0);
                
                const pendingWBNB = ethers.formatEther(pending);
                const pointsFormatted = ethers.formatUnits(points, tokenDecimals);
                
                document.getElementById('pendingWBNB').textContent = formatAmount(pendingWBNB, 4);
                document.getElementById('totalClaimedWBNB').textContent = formatAmount(ethers.formatEther(claimed), 4);
                document.getElementById('dividendPoints').textContent = formatAmount(pointsFormatted);
                document.getElementById('myBurnAmount').textContent = formatAmount(pointsFormatted);
                document.getElementById('globalBurnAmount').textContent = formatAmount(ethers.formatUnits(totalBurned, tokenDecimals));
                document.getElementById('myTotalBurned').textContent = formatAmount(pointsFormatted);
                document.getElementById('globalBurned').textContent = formatAmount(ethers.formatUnits(totalBurned, tokenDecimals));
                
                document.getElementById('claimBtn').disabled = pending <= 0;
                
            } catch (error) { console.error('åŠ è½½åˆ†çº¢æ•°æ®å¤±è´¥:', error); }
        }

        async function claimDividend() {
            if (!HAS_DIVIDEND_CONTRACT || !dividendContract) { showToast('æœªé…ç½®åˆ†çº¢åˆçº¦', true); return; }
            const btn = document.getElementById('claimBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';
            try {
                // TODO: Contract Call - é¢†å–åˆ†çº¢
                const tx = await dividendContract.claim();
                showToast('é¢†å–äº¤æ˜“å·²å‘é€...');
                await tx.wait();
                await loadDividendData();
                showToast('WBNBåˆ†çº¢é¢†å–æˆåŠŸï¼');
            } catch (error) {
                showToast('é¢†å–å¤±è´¥: ' + error.message, true);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'é¢†å–åˆ†çº¢';
            }
        }

        // ==================== æ¸¸æˆåŠŸèƒ½ ====================
        async function startGame() {
            if (!userAddress) { showToast('è¯·å…ˆè¿æ¥é’±åŒ…', true); return; }
            
            // TODO: Contract Call - åˆ›å»ºæ¸¸æˆæˆ¿é—´
            // 1. è°ƒç”¨ gameContract.createRoom(stakeAmount) 
            // 2. ç›‘å¬ GameStarted äº‹ä»¶è·å–æˆ¿é—´ID
            // 3. æˆ–ä½¿ç”¨ AI å¯¹æˆ˜æ¨¡å¼ç›´æ¥å¼€å§‹
            
            showPage('game');
            showToast('æ¸¸æˆå¼€å§‹ï¼å¯¹æˆ˜AI-æç™½å’ŒAI-æœç”«');
            
            // æ¨¡æ‹Ÿå‘ç‰Œ
            setTimeout(() => {
                document.getElementById('startControl').style.display = 'none';
                document.getElementById('gameControls').style.display = 'flex';
                renderHandCards();
                document.getElementById('turnInfo').textContent = 'è¯·é€‰æ‹©è¦å‡ºçš„ç‰Œ';
            }, 1000);
            
            // TODO: Contract Call - è·å–å¥–æ± ä¿¡æ¯
            // const gameInfo = await gameContract.getGameInfo(roomId);
            // document.getElementById('gamePot').textContent = 'å¥–æ± : ' + formatAmount(ethers.formatUnits(gameInfo.pot)) + ' TMFS';
        }

        function renderHandCards() {
            const handContainer = document.getElementById('playerHand');
            const cards = ['3â™ ï¸', '4â™¥ï¸', '5â™£ï¸', '6â™¦ï¸', '7â™ ï¸', '8â™¥ï¸', '9â™£ï¸', '10â™¦ï¸', 'Jâ™ ï¸', 'Qâ™¥ï¸', 'Kâ™£ï¸', 'Aâ™¦ï¸', '2â™ ï¸', 'å°ç‹', 'å¤§ç‹', '3â™¥ï¸', '4â™£ï¸'];
            
            handContainer.innerHTML = cards.map((card, index) => `
                <div class="hand-card ${card.includes('â™¥ï¸') || card.includes('â™¦ï¸') ? 'card-red' : 'card-black'}" 
                     onclick="toggleCard(${index})" data-index="${index}">
                    ${card}
                </div>
            `).join('');
        }

        function toggleCard(index) {
            const card = document.querySelector(`[data-index="${index}"]`);
            const idx = selectedCards.indexOf(index);
            if (idx > -1) {
                selectedCards.splice(idx, 1);
                card.classList.remove('selected');
            } else {
                selectedCards.push(index);
                card.classList.add('selected');
            }
        }

        async function playCards() {
            if (selectedCards.length === 0) { showToast('è¯·é€‰æ‹©è¦å‡ºçš„ç‰Œ', true); return; }
            
            // TODO: Contract Call - å‡ºç‰Œ
            // 1. å¯¹é€‰ä¸­çš„ç‰Œè¿›è¡Œç­¾å
            // 2. è°ƒç”¨ gameContract.playCards(roomId, cardIndices, signature)
            // 3. ç›‘å¬ CardsPlayed äº‹ä»¶
            
            showToast('å‡ºç‰ŒæˆåŠŸï¼');
            selectedCards = [];
            document.querySelectorAll('.hand-card').forEach(c => c.classList.remove('selected'));
            
            // æ¨¡æ‹ŸAIå›åˆ
            document.getElementById('turnInfo').textContent = 'AIæ€è€ƒä¸­...';
            setTimeout(() => {
                document.getElementById('turnInfo').textContent = 'è½®åˆ°ä½ äº†';
            }, 2000);
        }

        async function skipTurn() {
            // TODO: Contract Call - è·³è¿‡å›åˆ gameContract.skipTurn(roomId)
            showToast('è·³è¿‡å›åˆ');
        }

        function exitGame() {
            if (confirm('ç¡®å®šè¦é€€å‡ºæ¸¸æˆå—ï¼Ÿ')) {
                showPage('home');
                selectedCards = [];
                document.getElementById('startControl').style.display = 'block';
                document.getElementById('gameControls').style.display = 'none';
                document.getElementById('playerHand').innerHTML = '';
            }
        }

        // ==================== æ’è¡ŒåŠŸèƒ½ ====================
        async function loadRankData() {
            // TODO: Contract Call - è·å–ç‡ƒçƒ§æ’è¡Œæ¦œ
            // å»ºè®®: ä»åˆ†çº¢åˆçº¦è·å– burnRecords æˆ–ä»åç«¯APIè·å–
            // 1. è·å–å‰100åç‡ƒçƒ§åœ°å€
            // 2. è·å–ç”¨æˆ·è‡ªå·±çš„æ’å
            // 3. è®¡ç®—é¢„è®¡æ”¶ç›Š (ç§¯åˆ† / æ€»ç§¯åˆ† * æ¯æ—¥åˆ†å‘é‡)
            
            try {
                // æ¨¡æ‹Ÿæ•°æ®
                const mockData = [
                    { rank: 1, address: '0x8888...8888', amount: '1000000', reward: '5.2' },
                    { rank: 2, address: '0x7777...7777', amount: '800000', reward: '4.1' },
                    { rank: 3, address: '0x6666...6666', amount: '600000', reward: '3.2' },
                ];
                
                // å®é™…åº”ä»åˆçº¦è·å–:
                // const topBurners = await dividendContract.getTopBurners(100);
                // const myRank = await dividendContract.getUserRank(userAddress);
                
            } catch (error) {
                console.error('åŠ è½½æ’è¡Œå¤±è´¥:', error);
            }
        }

        function switchRankTab(tab) {
            document.querySelectorAll('.rank-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // TODO: Contract Call - åˆ‡æ¢æ’è¡Œç±»å‹
            // if (tab === 'burn') æŒ‰ç‡ƒçƒ§é‡æ’åº
            // if (tab === 'reward') æŒ‰æ”¶ç›Šæ’åº
        }

        // ==================== é¡µé¢åˆ‡æ¢ ====================
        function showPage(page) {
            ['homePage', 'gamePage', 'burnPage', 'claimPage', 'rankPage'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            const pageMap = { 'home': 'homePage', 'game': 'gamePage', 'burn': 'burnPage', 'claim': 'claimPage', 'rank': 'rankPage' };
            if (pageMap[page]) {
                document.getElementById(pageMap[page]).style.display = 'block';
            }
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
            
            // åŠ è½½ç‰¹å®šé¡µé¢æ•°æ®
            if (page === 'claim' || page === 'burn') {
                if (tokenContract) { loadAllData(); loadDividendData(); }
            } else if (page === 'rank') {
                loadRankData();
            }
        }

        // ==================== åˆå§‹åŒ– ====================
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', () => location.reload());
            window.ethereum.on('chainChanged', () => location.reload());
        }

        window.addEventListener('load', () => {
            console.log('âœ… DApp å·²åŠ è½½');
            // å®šæ—¶åˆ·æ–°ä»·æ ¼
            setInterval(fetchTokenPrice, 30000);
        });
    </script>
</body>
</html>
