<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è¸é©¬å°ç¥ - ç‡ƒçƒ§åˆ†çº¢</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#0b0f17;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto}
    .container{max-width:420px;margin:0 auto;padding:25px}
    
    .wallet-bar {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .wallet-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ef4444;
      box-shadow: 0 0 8px #ef4444;
      transition: all 0.3s;
    }
    .status-dot.connected {
      background: #10b981;
      box-shadow: 0 0 8px #10b981;
    }
    .wallet-btn {
      background: #3b82f6;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .wallet-btn.disconnect {
      background: #475569;
    }
    .wallet-info {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }
    
    .card{background:#121a29;border-radius:16px;padding:24px;margin-bottom:16px}
    .title{font-size:22px;font-weight:700;color:#ffdf4f;margin-bottom:6px}
    .subtitle{color:#9ca3af;font-size:14px;margin-bottom:20px}
    .input-box{position:relative}
    input{width:100%;background:#1e293b;border:none;border-radius:12px;padding:14px 16px;color:#fff;font-size:16px;margin-bottom:12px}
    button{width:100%;padding:16px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer}
    .btn-burn{background:#ef4444;color:#fff;margin-bottom:8px}
    .btn-burn:hover{background:#dc2626}
    .btn-claim{background:#10b981;color:#fff}
    .btn-claim:hover{background:#059669}
    .btn-claim:disabled{background:#334155;cursor:not-allowed}
    .panel{display:flex;justify-content:space-between;background:#111827;padding:14px 16px;border-radius:12px;margin-bottom:10px;align-items:center}
    .label{color:#9ca3af;font-size:13px}
    .value{color:#fff;font-weight:600;font-size:16px}
    .balance-tag{font-size:11px;color:#64748b;margin-top:4px}
    .max-btn{text-align:right;margin-top:-8px;margin-bottom:8px;cursor:pointer;color:#3b82f6;font-size:13px}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-left:8px;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
<div class="container">

  <div class="wallet-bar" id="walletBar">
    <div class="wallet-status">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">æœªè¿æ¥é’±åŒ…</span>
    </div>
    <button class="wallet-btn" id="connectBtn" onclick="toggleWallet()">è¿æ¥é’±åŒ…</button>
    <div class="wallet-info" id="walletInfo" style="display:none;">
      <span id="networkName">--</span>
      <span id="tokenBalance">ä½™é¢: -- è¸é©¬å°ç¥</span>
    </div>
  </div>

  <div class="card">
    <div class="title">ğŸ”¥ è¸é©¬å°ç¥ ç‡ƒçƒ§åˆ†çº¢</div>
    <div class="subtitle">Burn To Earn | ç‡ƒçƒ§è·å–åˆ†çº¢æƒ</div>

    <div class="panel">
      <div>
        <div class="label">æˆ‘çš„å¯é¢†å–åˆ†çº¢</div>
        <div class="balance-tag" id="claimableUsd">â‰ˆ $0.00</div>
      </div>
      <div class="value" id="pending">0.00 BNB</div>
    </div>
    <div class="panel">
      <div class="label">æˆ‘å·²ç‡ƒçƒ§</div>
      <div class="value" id="myburn">0 è¸é©¬å°ç¥</div>
    </div>
    <div class="panel">
      <div class="label">å…¨ç½‘æ€»ç‡ƒçƒ§</div>
      <div class="value" id="totalburn">0 è¸é©¬å°ç¥</div>
    </div>

    <div class="input-box">
      <input id="amount" type="number" placeholder="è¾“å…¥ç‡ƒçƒ§æ•°é‡" min="0" step="0.01"/>
      <div class="max-btn" onclick="setMax()">æœ€å¤§å¯ç”¨: <span id="maxAmount">0</span> è¸é©¬å°ç¥</div>
    </div>

    <button class="btn-burn" id="burnBtn" onclick="burn()">ğŸ”¥ ç«‹å³ç‡ƒçƒ§</button>
    <button class="btn-claim" id="claimBtn" onclick="claim()">ğŸ’° é¢†å–åˆ†çº¢</button>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.3/dist/web3.min.js"></script>
<script>
const CONTRACT = "0x9a889E525FAEF4851bf5BEbfb5F294AC9D097777";

// å®Œæ•´çš„ ABIï¼ˆåŒ…å« ERC20 æ ‡å‡†å’Œç‡ƒçƒ§åˆ†çº¢åŠŸèƒ½ï¼‰
const ABI = [
  // ERC20 æ ‡å‡†
  {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},
  // ç‡ƒçƒ§åˆ†çº¢åŠŸèƒ½
  {"inputs":[{"name":"amount","type":"uint256"}],"name":"burn","stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"claim","stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"name":"user","type":"address"}],"name":"claimable","outputs":[{"name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"name":"user","type":"address"}],"name":"burnAmount","outputs":[{"name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"totalBurned","outputs":[{"name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

let web3 = null;
let account = null;
let contract = null;

async function toggleWallet() {
  if (account) {
    disconnect();
  } else {
    connect();
  }
}

async function connect() {
  try {
    if (!window.ethereum) {
      alert('è¯·ä½¿ç”¨ TokenPocketã€MetaMask æˆ– OKX é’±åŒ…æ‰“å¼€');
      return;
    }
    
    web3 = new Web3(window.ethereum);
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    account = accounts[0];
    
    contract = new web3.eth.Contract(ABI, CONTRACT);
    
    // æ›´æ–° UI
    document.getElementById('statusDot').classList.add('connected');
    document.getElementById('statusText').textContent = account.slice(0, 6) + '...' + account.slice(-4);
    document.getElementById('connectBtn').textContent = 'æ–­å¼€è¿æ¥';
    document.getElementById('connectBtn').classList.add('disconnect');
    document.getElementById('walletInfo').style.display = 'flex';
    
    // è·å–ç½‘ç»œ
    const chainId = await web3.eth.getChainId();
    const names = {56: 'BSC Mainnet', 97: 'BSC Testnet', 1: 'Ethereum'};
    document.getElementById('networkName').textContent = names[chainId] || 'Chain ' + chainId;
    
    // åŠ è½½æ•°æ®
    await loadData();
    
    // ç›‘å¬åˆ‡æ¢
    window.ethereum.on('accountsChanged', (accs) => {
      if (accs.length === 0) disconnect();
      else { account = accs[0]; loadData(); }
    });
    
    localStorage.setItem('walletConnected', 'true');
    
  } catch (err) {
    alert('è¿æ¥å¤±è´¥: ' + err.message);
  }
}

function disconnect() {
  account = null;
  contract = null;
  localStorage.removeItem('walletConnected');
  document.getElementById('statusDot').classList.remove('connected');
  document.getElementById('statusText').textContent = 'æœªè¿æ¥é’±åŒ…';
  document.getElementById('connectBtn').textContent = 'è¿æ¥é’±åŒ…';
  document.getElementById('connectBtn').classList.remove('disconnect');
  document.getElementById('walletInfo').style.display = 'none';
}

async function loadData() {
  if (!contract || !account) return;
  
  try {
    // ä½™é¢
    const bal = await contract.methods.balanceOf(account).call();
    const balEth = parseFloat(web3.utils.fromWei(bal, 'ether')).toFixed(2);
    document.getElementById('tokenBalance').textContent = `ä½™é¢: ${balEth} è¸é©¬å°ç¥`;
    document.getElementById('maxAmount').textContent = balEth;
    
    // å¯é¢†å–åˆ†çº¢
    const claimable = await contract.methods.claimable(account).call();
    const claimEth = parseFloat(web3.utils.fromWei(claimable, 'ether')).toFixed(4);
    document.getElementById('pending').textContent = claimEth + ' BNB';
    document.getElementById('claimableUsd').textContent = 'â‰ˆ $' + (claimEth * 300).toFixed(2);
    
    // å·²ç‡ƒçƒ§
    const burned = await contract.methods.burnAmount(account).call();
    document.getElementById('myburn').textContent = web3.utils.fromWei(burned, 'ether') + ' è¸é©¬å°ç¥';
    
    // æ€»ç‡ƒçƒ§
    const total = await contract.methods.totalBurned().call();
    document.getElementById('totalburn').textContent = web3.utils.fromWei(total, 'ether') + ' è¸é©¬å°ç¥';
    
  } catch (err) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', err);
  }
}

function setMax() {
  const max = document.getElementById('maxAmount').textContent;
  if (max > 0) document.getElementById('amount').value = max;
}

async function burn() {
  if (!account) return connect();
  
  const amt = document.getElementById('amount').value;
  if (!amt || amt <= 0) return alert('è¯·è¾“å…¥ç‡ƒçƒ§æ•°é‡');
  
  const btn = document.getElementById('burnBtn');
  btn.innerHTML = '<span class="loading"></span> å¤„ç†ä¸­...';
  btn.disabled = true;
  
  try {
    const val = web3.utils.toWei(amt, 'ether');
    await contract.methods.burn(val).send({from: account})
      .on('transactionHash', h => alert('å·²æäº¤: ' + h.slice(0, 10) + '...'))
      .on('receipt', () => {
        alert('âœ… ç‡ƒçƒ§æˆåŠŸï¼');
        document.getElementById('amount').value = '';
        loadData();
      });
  } catch (err) {
    alert('å¤±è´¥: ' + (err.message || 'ç”¨æˆ·å–æ¶ˆ'));
  } finally {
    btn.innerHTML = 'ğŸ”¥ ç«‹å³ç‡ƒçƒ§';
    btn.disabled = false;
  }
}

async function claim() {
  if (!account) return connect();
  
  const btn = document.getElementById('claimBtn');
  btn.innerHTML = '<span class="loading"></span> é¢†å–ä¸­...';
  btn.disabled = true;
  
  try {
    await contract.methods.claim().send({from: account})
      .on('transactionHash', h => alert('å·²æäº¤: ' + h.slice(0, 10) + '...'))
      .on('receipt', () => {
        alert('âœ… åˆ†çº¢é¢†å–æˆåŠŸï¼');
        loadData();
      });
  } catch (err) {
    alert('å¤±è´¥: ' + (err.message || 'ç”¨æˆ·å–æ¶ˆ'));
  } finally {
    btn.innerHTML = 'ğŸ’° é¢†å–åˆ†çº¢';
    btn.disabled = false;
  }
}

// è‡ªåŠ¨è¿æ¥
if (localStorage.getItem('walletConnected') === 'true') {
  connect();
}

// æ¯ 10 ç§’åˆ·æ–°æ•°æ®
setInterval(loadData, 10000);
</script>
</body>
</html>
